"use strict";
/**
 * Basically it is a copy of require-injector/dist/dir-tree, but for browser side
 * and not related to local file system, as a pure data structure
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DirTree = void 0;
const has_1 = __importDefault(require("lodash/has"));
const repeat_1 = __importDefault(require("lodash/repeat"));
const each_1 = __importDefault(require("lodash/each"));
class DirTree {
    constructor(caseSensitive = false) {
        this.caseSensitive = caseSensitive;
        this.root = { map: {}, name: '' };
    }
    putRootData(data) {
        this.root.data = data;
    }
    getRootData() {
        return this.root.data;
    }
    putData(path, data) {
        var tree = this.ensureNode(path);
        tree.data = data;
    }
    getData(path) {
        var tree = this.findNode(path);
        return tree ? tree.data : null;
    }
    /**
       * @return Array of data
       */
    getAllData(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.getAllData(path.split(/[/\\]/));
        }
        let tree = this.root;
        const datas = [];
        if (has_1.default(tree, 'data'))
            datas.push(tree.data);
        path.every(name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
                if (has_1.default(tree, 'data'))
                    datas.push(tree.data);
                return true;
            }
            // tree = null;
            return false;
        });
        return datas;
    }
    ensureNode(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.ensureNode(path.split(/[/\\]/));
        }
        var tree = this.root;
        each_1.default(path, name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
            }
            else {
                var child = { map: {}, name };
                tree.map[name] = child;
                tree = child;
            }
        });
        return tree;
    }
    findNode(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.findNode(path.split(/[/\\]/));
        }
        var tree = this.root;
        path.every(name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
                return true;
            }
            tree = null;
            return false;
        });
        return tree;
    }
    traverse(level = 0, tree, lines) {
        var isRoot = false;
        if (!tree)
            tree = this.root;
        if (!lines) {
            isRoot = true;
            lines = [];
        }
        var indent = repeat_1.default('│  ', level);
        lines.push(indent + '├─ ' + tree.name + (tree.data ? ' [x]' : ''));
        each_1.default(tree.map, (subTree) => {
            this.traverse(level + 1, subTree, lines);
        });
        return isRoot ? lines.join('\n') : lines;
    }
    toString() {
        return this.traverse();
    }
}
exports.DirTree = DirTree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlyLXRyZWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkaXItdHJlZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7Ozs7QUFFSCxxREFBOEI7QUFDOUIsMkRBQW9DO0FBQ3BDLHVEQUFnQztBQU9oQyxNQUFhLE9BQU87SUFHbEIsWUFBb0IsZ0JBQWdCLEtBQUs7UUFBckIsa0JBQWEsR0FBYixhQUFhLENBQVE7UUFGekMsU0FBSSxHQUFnQixFQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBQyxDQUFDO0lBRUksQ0FBQztJQUU3QyxXQUFXLENBQUMsSUFBTztRQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDeEIsQ0FBQztJQUVELFdBQVc7UUFDVCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxPQUFPLENBQUMsSUFBWSxFQUFFLElBQU87UUFDM0IsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUNuQixDQUFDO0lBRUQsT0FBTyxDQUFDLElBQVk7UUFDbEIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQixPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7U0FFRTtJQUNGLFVBQVUsQ0FBQyxJQUF1QjtRQUNoQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN4QixJQUFJLElBQUksQ0FBQyxhQUFhO2dCQUNwQixJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzVCLE9BQU8sSUFBSSxDQUFD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LE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLElBQUk7WUFDUCxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUNuQixJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsTUFBTSxHQUFHLElBQUksQ0FBQztZQUNkLEtBQUssR0FBRyxFQUFFLENBQUM7U0FDWjtRQUNELElBQUksTUFBTSxHQUFHLGdCQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ25DLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ25FLGNBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDMUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDM0MsQ0FBQztJQUVELFFBQVE7UUFDTixPQUFPLElBQUksQ0FBQyxRQUFRLEVBQVksQ0FBQztJQUNuQyxDQUFDO0NBQ0Y7QUF6R0QsMEJBeUdDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBCYXNpY2FsbHkgaXQgaXMgYSBjb3B5IG9mIHJlcXVpcmUtaW5qZWN0b3IvZGlzdC9kaXItdHJlZSwgYnV0IGZvciBicm93c2VyIHNpZGVcbiAqIGFuZCBub3QgcmVsYXRlZCB0byBsb2NhbCBmaWxlIHN5c3RlbSwgYXMgYSBwdXJlIGRhdGEgc3RydWN0dXJlXG4gKi9cblxuaW1wb3J0IF9oYXMgZnJvbSAnbG9kYXNoL2hhcyc7XG5pbXBvcnQgX3JlcGVhdCBmcm9tICdsb2Rhc2gvcmVwZWF0JztcbmltcG9ydCBfZWFjaCBmcm9tICdsb2Rhc2gvZWFjaCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJlZU5vZGU8VD4ge1xuICBtYXA6IHtbY2hpbGQ6IHN0cmluZ106IFRyZWVOb2RlPFQ+fTtcbiAgbmFtZTogc3RyaW5nO1xuICBkYXRhPzogVDtcbn1cbmV4cG9ydCBjbGFzcyBEaXJUcmVlPFQ+IHtcbiAgcm9vdDogVHJlZU5vZGU8VD4gPSB7bWFwOiB7fSwgbmFtZTogJyd9O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2FzZVNlbnNpdGl2ZSA9IGZhbHNlKSB7fVxuXG4gIHB1dFJvb3REYXRhKGRhdGE6IFQpIHtcbiAgICB0aGlzLnJvb3QuZGF0YSA9IGRhdGE7XG4gIH1cblxuICBnZXRSb290RGF0YSgpIHtcbiAgICByZXR1cm4gdGhpcy5yb290LmRhdGE7XG4gIH1cblxuICBwdXREYXRhKHBhdGg6IHN0cmluZywgZGF0YTogVCkge1xuICAgIHZhciB0cmVlID0gdGhpcy5lbnN1cmVOb2RlKHBhdGgpO1xuICAgIHRyZWUuZGF0YSA9IGRhdGE7XG4gIH1cblxuICBnZXREYXRhKHBhdGg6IHN0cmluZyk6IFQgfCBudWxsIHwgdW5kZWZpbmVkIHtcbiAgICB2YXIgdHJlZSA9IHRoaXMuZmluZE5vZGUocGF0aCk7XG4gICAgcmV0dXJuIHRyZWUgPyB0cmVlLmRhdGEgOiBudWxsO1xuICB9XG5cbiAgLyoqXG5cdCAqIEByZXR1cm4gQXJyYXkgb2YgZGF0YVxuXHQgKi9cbiAgZ2V0QWxsRGF0YShwYXRoOiBzdHJpbmcgfCBzdHJpbmdbXSk6IFRbXSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGgpKSB7XG4gICAgICBpZiAodGhpcy5jYXNlU2Vuc2l0aXZlKVxuICAgICAgICBwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsRGF0YShwYXRoLnNwbGl0KC9bL1xcXFxdLykpO1xuICAgIH1cbiAgICBsZXQgdHJlZSA9IHRoaXMucm9vdDtcbiAgICBjb25zdCBkYXRhczogVFtdID0gW107XG4gICAgaWYgKF9oYXModHJlZSwgJ2RhdGEnKSlcbiAgICAgIGRhdGFzLnB1c2godHJlZS5kYXRhISk7XG4gICAgcGF0aC5ldmVyeShuYW1lID0+IHtcbiAgICAgIGlmIChfaGFzKHRyZWUsIFsnbWFwJywgbmFtZV0pKSB7XG4gICAgICAgIHRyZWUgPSB0cmVlLm1hcFtuYW1lXTtcbiAgICAgICAgaWYgKF9oYXModHJlZSwgJ2RhdGEnKSlcbiAgICAgICAgICBkYXRhcy5wdXNoKHRyZWUuZGF0YSEpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIC8vIHRyZWUgPSBudWxsO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICAgIHJldHVybiBkYXRhcztcbiAgfVxuXG4gIGVuc3VyZU5vZGUocGF0aDogc3RyaW5nIHwgc3RyaW5nW10pOiBUcmVlTm9kZTxUPiB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGgpKSB7XG4gICAgICBpZiAodGhpcy5jYXNlU2Vuc2l0aXZlKVxuICAgICAgICBwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuICAgICAgcmV0dXJuIHRoaXMuZW5zdXJlTm9kZShwYXRoLnNwbGl0KC9bL1xcXFxdLykpO1xuICAgIH1cbiAgICB2YXIgdHJlZSA9IHRoaXMucm9vdDtcbiAgICBfZWFjaChwYXRoLCBuYW1lID0+IHtcbiAgICAgIGlmIChfaGFzKHRyZWUsIFsnbWFwJywgbmFtZV0pKSB7XG4gICAgICAgIHRyZWUgPSB0cmVlLm1hcFtuYW1lXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBjaGlsZCA9IHttYXA6IHt9LCBuYW1lfTtcbiAgICAgICAgdHJlZS5tYXBbbmFtZV0gPSBjaGlsZDtcbiAgICAgICAgdHJlZSA9IGNoaWxkO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB0cmVlO1xuICB9XG5cbiAgZmluZE5vZGUocGF0aDogc3RyaW5nIHwgc3RyaW5nW10pOiBUcmVlTm9kZTxUPiB8IG51bGwge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShwYXRoKSkge1xuICAgICAgaWYgKHRoaXMuY2FzZVNlbnNpdGl2ZSlcbiAgICAgICAgcGF0aCA9IHBhdGgudG9Mb3dlckNhc2UoKTtcbiAgICAgIHJldHVybiB0aGlzLmZpbmROb2RlKHBhdGguc3BsaXQoL1svXFxcXF0vKSk7XG4gICAgfVxuICAgIHZhciB0cmVlOiBUcmVlTm9kZTxUPiB8IG51bGwgPSB0aGlzLnJvb3Q7XG4gICAgcGF0aC5ldmVyeShuYW1lID0+IHtcbiAgICAgIGlmIChfaGFzKHRyZWUsIFsnbWFwJywgbmFtZV0pKSB7XG4gICAgICAgIHRyZWUgPSB0cmVlIS5tYXBbbmFtZV07XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgdHJlZSA9IG51bGw7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRyZWU7XG4gIH1cblxuICB0cmF2ZXJzZShsZXZlbDogbnVtYmVyID0gMCwgdHJlZT86IFRyZWVOb2RlPFQ+LCBsaW5lcz86IHN0cmluZ1tdKSB7XG4gICAgdmFyIGlzUm9vdCA9IGZhbHNlO1xuICAgIGlmICghdHJlZSlcbiAgICAgIHRyZWUgPSB0aGlzLnJvb3Q7XG4gICAgaWYgKCFsaW5lcykge1xuICAgICAgaXNSb290ID0gdHJ1ZTtcbiAgICAgIGxpbmVzID0gW107XG4gICAgfVxuICAgIHZhciBpbmRlbnQgPSBfcmVwZWF0KCfilIIgICcsIGxldmVsKTtcbiAgICBsaW5lcy5wdXNoKGluZGVudCArICfilJzilIAgJyArIHRyZWUubmFtZSArICh0cmVlLmRhdGEgPyAnIFt4XScgOiAnJykpO1xuICAgIF9lYWNoKHRyZWUubWFwLCAoc3ViVHJlZSkgPT4ge1xuICAgICAgdGhpcy50cmF2ZXJzZShsZXZlbCArIDEsIHN1YlRyZWUsIGxpbmVzKTtcbiAgICB9KTtcbiAgICByZXR1cm4gaXNSb290ID8gbGluZXMuam9pbignXFxuJykgOiBsaW5lcztcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiB0aGlzLnRyYXZlcnNlKCkgYXMgc3RyaW5nO1xuICB9XG59XG4iXX0=