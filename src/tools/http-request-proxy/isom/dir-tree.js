"use strict";
/**
 * Basically it is a copy of require-injector/dist/dir-tree, but for browser side
 * and not related to local file system, as a pure data structure
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const has_1 = tslib_1.__importDefault(require("lodash/has"));
const repeat_1 = tslib_1.__importDefault(require("lodash/repeat"));
const each_1 = tslib_1.__importDefault(require("lodash/each"));
class DirTree {
    constructor(caseSensitive = false) {
        this.caseSensitive = caseSensitive;
        this.root = { map: {}, name: '' };
    }
    putData(path, data) {
        var tree = this.ensureNode(path);
        tree.data = data;
    }
    getData(path) {
        var tree = this.findNode(path);
        return tree ? tree.data : null;
    }
    /**
     * @return Array of data
     */
    getAllData(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.getAllData(path.replace(/\\/g, '/').split('/'));
        }
        let tree = this.root;
        const datas = [];
        if (has_1.default(tree, 'data'))
            datas.push(tree.data);
        path.every(name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
                if (has_1.default(tree, 'data'))
                    datas.push(tree.data);
                return true;
            }
            // tree = null;
            return false;
        });
        return datas;
    }
    ensureNode(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.ensureNode(path.replace(/\\/g, '/').split('/'));
        }
        var tree = this.root;
        each_1.default(path, name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
            }
            else {
                var child = { map: {}, name };
                tree.map[name] = child;
                tree = child;
            }
        });
        return tree;
    }
    findNode(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.findNode(path.replace(/\\/g, '/').split('/'));
        }
        var tree = this.root;
        path.every(name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
                return true;
            }
            tree = null;
            return false;
        });
        return tree;
    }
    traverse(level = 0, tree, lines) {
        var isRoot = false;
        if (!tree)
            tree = this.root;
        if (!lines) {
            isRoot = true;
            lines = [];
        }
        var indent = repeat_1.default('│  ', level);
        lines.push(indent + '├─ ' + tree.name + (tree.data ? ' [x]' : ''));
        each_1.default(tree.map, (subTree) => {
            this.traverse(level + 1, subTree, lines);
        });
        return isRoot ? lines.join('\n') : lines;
    }
    toString() {
        return this.traverse();
    }
}
exports.DirTree = DirTree;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9AZHIvaHR0cC1yZXF1ZXN0LXByb3h5L2lzb20vZGlyLXRyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsNkRBQThCO0FBQzlCLG1FQUFvQztBQUNwQywrREFBZ0M7QUFPaEMsTUFBYSxPQUFPO0lBR25CLFlBQW9CLGdCQUFnQixLQUFLO1FBQXJCLGtCQUFhLEdBQWIsYUFBYSxDQUFRO1FBRnpDLFNBQUksR0FBZ0IsRUFBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUMsQ0FBQztJQUVJLENBQUM7SUFFN0MsT0FBTyxDQUFDLElBQVksRUFBRSxJQUFPO1FBQzVCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbEIsQ0FBQztJQUVELE9BQU8sQ0FBQyxJQUFZO1FBQ25CLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNoQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVLENBQUMsSUFBdUI7UUFDakMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDekIsSUFBSSxJQUFJLENBQUMsYUFBYTtnQkFDckIsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMzQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDNUQ7UUFDRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3JC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Q0FBQyxJQUFJO1lBQ1IsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDbEIsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNYLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDZCxLQUFLLEdBQUcsRUFBRSxDQUFDO1NBQ1g7UUFDRCxJQUFJLE1BQU0sR0FBRyxnQkFBTyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNuQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNuRSxjQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sRUFBRSxFQUFFO1lBQzNCLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBQzFDLENBQUM7SUFFRCxRQUFRO1FBQ1AsT0FBTyxJQUFJLENBQUMsUUFBUSxFQUFZLENBQUM7SUFDbEMsQ0FBQztDQUNEO0FBakdELDBCQWlHQyIsImZpbGUiOiJub2RlX21vZHVsZXMvQGRyL2h0dHAtcmVxdWVzdC1wcm94eS9pc29tL2Rpci10cmVlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBCYXNpY2FsbHkgaXQgaXMgYSBjb3B5IG9mIHJlcXVpcmUtaW5qZWN0b3IvZGlzdC9kaXItdHJlZSwgYnV0IGZvciBicm93c2VyIHNpZGVcbiAqIGFuZCBub3QgcmVsYXRlZCB0byBsb2NhbCBmaWxlIHN5c3RlbSwgYXMgYSBwdXJlIGRhdGEgc3RydWN0dXJlXG4gKi9cblxuaW1wb3J0IF9oYXMgZnJvbSAnbG9kYXNoL2hhcyc7XG5pbXBvcnQgX3JlcGVhdCBmcm9tICdsb2Rhc2gvcmVwZWF0JztcbmltcG9ydCBfZWFjaCBmcm9tICdsb2Rhc2gvZWFjaCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJlZU5vZGU8VD4ge1xuXHRtYXA6IHtbY2hpbGQ6IHN0cmluZ106IFRyZWVOb2RlPFQ+fTtcblx0bmFtZTogc3RyaW5nO1xuXHRkYXRhPzogVDtcbn1cbmV4cG9ydCBjbGFzcyBEaXJUcmVlPFQ+IHtcblx0cm9vdDogVHJlZU5vZGU8VD4gPSB7bWFwOiB7fSwgbmFtZTogJyd9O1xuXG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgY2FzZVNlbnNpdGl2ZSA9IGZhbHNlKSB7fVxuXG5cdHB1dERhdGEocGF0aDogc3RyaW5nLCBkYXRhOiBUKSB7XG5cdFx0dmFyIHRyZWUgPSB0aGlzLmVuc3VyZU5vZGUocGF0aCk7XG5cdFx0dHJlZS5kYXRhID0gZGF0YTtcblx0fVxuXG5cdGdldERhdGEocGF0aDogc3RyaW5nKTogVCB8IG51bGwgfCB1bmRlZmluZWQge1xuXHRcdHZhciB0cmVlID0gdGhpcy5maW5kTm9kZShwYXRoKTtcblx0XHRyZXR1cm4gdHJlZSA/IHRyZWUuZGF0YSA6IG51bGw7XG5cdH1cblxuXHQvKipcblx0ICogQHJldHVybiBBcnJheSBvZiBkYXRhXG5cdCAqL1xuXHRnZXRBbGxEYXRhKHBhdGg6IHN0cmluZyB8IHN0cmluZ1tdKTogVFtdIHtcblx0XHRpZiAoIUFycmF5LmlzQXJyYXkocGF0aCkpIHtcblx0XHRcdGlmICh0aGlzLmNhc2VTZW5zaXRpdmUpXG5cdFx0XHRcdHBhdGggPSBwYXRoLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRBbGxEYXRhKHBhdGgucmVwbGFjZSgvXFxcXC9nLCAnLycpLnNwbGl0KCcvJykpO1xuXHRcdH1cblx0XHRsZXQgdHJlZSA9IHRoaXMucm9vdDtcblx0XHRjb25zdCBkYXRhczogVFtdID0gW107XG5cdFx0aWYgKF9oYXModHJlZSwgJ2RhdGEnKSlcblx0XHRcdGRhdGFzLnB1c2godHJlZS5kYXRhISk7XG5cdFx0cGF0aC5ldmVyeShuYW1lID0+IHtcblx0XHRcdGlmIChfaGFzKHRyZWUsIFsnbWFwJywgbmFtZV0pKSB7XG5cdFx0XHRcdHRyZWUgPSB0cmVlLm1hcFtuYW1lXTtcblx0XHRcdFx0aWYgKF9oYXModHJlZSwgJ2RhdGEnKSlcblx0XHRcdFx0XHRkYXRhcy5wdXNoKHRyZWUuZGF0YSEpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdC8vIHRyZWUgPSBudWxsO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0pO1xuXHRcdHJldHVybiBkYXRhcztcblx0fVxuXG5cdGVuc3VyZU5vZGUocGF0aDogc3RyaW5nIHwgc3RyaW5nW10pOiBUcmVlTm9kZTxUPiB7XG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KHBhdGgpKSB7XG5cdFx0XHRpZiAodGhpcy5jYXNlU2Vuc2l0aXZlKVxuXHRcdFx0XHRwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0cmV0dXJuIHRoaXMuZW5zdXJlTm9kZShwYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKS5zcGxpdCgnLycpKTtcblx0XHR9XG5cdFx0dmFyIHRyZWUgPSB0aGlzLnJvb3Q7XG5cdFx0X2VhY2gocGF0aCwgbmFtZSA9PiB7XG5cdFx0XHRpZiAoX2hhcyh0cmVlLCBbJ21hcCcsIG5hbWVdKSkge1xuXHRcdFx0XHR0cmVlID0gdHJlZS5tYXBbbmFtZV07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR2YXIgY2hpbGQgPSB7bWFwOiB7fSwgbmFtZX07XG5cdFx0XHRcdHRyZWUubWFwW25hbWVdID0gY2hpbGQ7XG5cdFx0XHRcdHRyZWUgPSBjaGlsZDtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRyZXR1cm4gdHJlZTtcblx0fVxuXG5cdGZpbmROb2RlKHBhdGg6IHN0cmluZyB8IHN0cmluZ1tdKTogVHJlZU5vZGU8VD4gfCBudWxsIHtcblx0XHRpZiAoIUFycmF5LmlzQXJyYXkocGF0aCkpIHtcblx0XHRcdGlmICh0aGlzLmNhc2VTZW5zaXRpdmUpXG5cdFx0XHRcdHBhdGggPSBwYXRoLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcy5maW5kTm9kZShwYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKS5zcGxpdCgnLycpKTtcblx0XHR9XG5cdFx0dmFyIHRyZWU6IFRyZWVOb2RlPFQ+IHwgbnVsbCA9IHRoaXMucm9vdDtcblx0XHRwYXRoLmV2ZXJ5KG5hbWUgPT4ge1xuXHRcdFx0aWYgKF9oYXModHJlZSwgWydtYXAnLCBuYW1lXSkpIHtcblx0XHRcdFx0dHJlZSA9IHRyZWUhLm1hcFtuYW1lXTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHR0cmVlID0gbnVsbDtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9KTtcblx0XHRyZXR1cm4gdHJlZTtcblx0fVxuXG5cdHRyYXZlcnNlKGxldmVsOiBudW1iZXIgPSAwLCB0cmVlPzogVHJlZU5vZGU8VD4sIGxpbmVzPzogc3RyaW5nW10pIHtcblx0XHR2YXIgaXNSb290ID0gZmFsc2U7XG5cdFx0aWYgKCF0cmVlKVxuXHRcdFx0dHJlZSA9IHRoaXMucm9vdDtcblx0XHRpZiAoIWxpbmVzKSB7XG5cdFx0XHRpc1Jvb3QgPSB0cnVlO1xuXHRcdFx0bGluZXMgPSBbXTtcblx0XHR9XG5cdFx0dmFyIGluZGVudCA9IF9yZXBlYXQoJ+KUgiAgJywgbGV2ZWwpO1xuXHRcdGxpbmVzLnB1c2goaW5kZW50ICsgJ+KUnOKUgCAnICsgdHJlZS5uYW1lICsgKHRyZWUuZGF0YSA/ICcgW3hdJyA6ICcnKSk7XG5cdFx0X2VhY2godHJlZS5tYXAsIChzdWJUcmVlKSA9PiB7XG5cdFx0XHR0aGlzLnRyYXZlcnNlKGxldmVsICsgMSwgc3ViVHJlZSwgbGluZXMpO1xuXHRcdH0pO1xuXHRcdHJldHVybiBpc1Jvb3QgPyBsaW5lcy5qb2luKCdcXG4nKSA6IGxpbmVzO1xuXHR9XG5cblx0dG9TdHJpbmcoKSB7XG5cdFx0cmV0dXJuIHRoaXMudHJhdmVyc2UoKSBhcyBzdHJpbmc7XG5cdH1cbn1cbiJdfQ==
