"use strict";
/**
 * Basically it is a copy of require-injector/dist/dir-tree, but for browser side
 * and not related to local file system, as a pure data structure
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const has_1 = tslib_1.__importDefault(require("lodash/has"));
const repeat_1 = tslib_1.__importDefault(require("lodash/repeat"));
const each_1 = tslib_1.__importDefault(require("lodash/each"));
class DirTree {
    constructor(caseSensitive = false) {
        this.caseSensitive = caseSensitive;
        this.root = { map: {}, name: '' };
    }
    putData(path, data) {
        var tree = this.ensureNode(path);
        tree.data = data;
    }
    getData(path) {
        var tree = this.findNode(path);
        return tree ? tree.data : null;
    }
    /**
       * @return Array of data
       */
    getAllData(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.getAllData(path.replace(/\\/g, '/').split('/'));
        }
        var tree = this.root;
        var datas = [];
        if (has_1.default(tree, 'data'))
            datas.push(tree.data);
        path.every(name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
                if (has_1.default(tree, 'data'))
                    datas.push(tree.data);
                return true;
            }
            tree = null;
            return false;
        });
        return datas;
    }
    ensureNode(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.ensureNode(path.replace(/\\/g, '/').split('/'));
        }
        var tree = this.root;
        each_1.default(path, name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
            }
            else {
                var child = { map: {}, name };
                tree.map[name] = child;
                tree = child;
            }
        });
        return tree;
    }
    findNode(path) {
        if (!Array.isArray(path)) {
            if (this.caseSensitive)
                path = path.toLowerCase();
            return this.findNode(path.replace(/\\/g, '/').split('/'));
        }
        var tree = this.root;
        path.every(name => {
            if (has_1.default(tree, ['map', name])) {
                tree = tree.map[name];
                return true;
            }
            tree = null;
            return false;
        });
        return tree;
    }
    traverse(level = 0, tree, lines) {
        var isRoot = false;
        if (!tree)
            tree = this.root;
        if (!lines) {
            isRoot = true;
            lines = [];
        }
        var indent = repeat_1.default('│  ', level);
        lines.push(indent + '├─ ' + tree.name + (tree.data ? ' [x]' : ''));
        each_1.default(tree.map, (subTree) => {
            this.traverse(level + 1, subTree, lines);
        });
        return isRoot ? lines.join('\n') : lines;
    }
    toString() {
        return this.traverse();
    }
}
exports.DirTree = DirTree;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9AZHIvaHR0cC1yZXF1ZXN0LXByb3h5L2lzb20vZGlyLXRyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsNkRBQThCO0FBQzlCLG1FQUFvQztBQUNwQywrREFBZ0M7QUFPaEMsTUFBYSxPQUFPO0lBR2xCLFlBQW9CLGdCQUFnQixLQUFLO1FBQXJCLGtCQUFhLEdBQWIsYUFBYSxDQUFRO1FBRnpDLFNBQUksR0FBZ0IsRUFBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUMsQ0FBQztJQUVJLENBQUM7SUFFN0MsT0FBTyxDQUFDLElBQVksRUFBRSxJQUFPO1FBQzNCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbkIsQ0FBQztJQUVELE9BQU8sQ0FBQyxJQUFZO1FBQ2xCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNqQyxDQUFDO0lBRUQ7O1NBRUU7SUFDRixVQUFVLENBQUMsSUFBdUI7UUFDaEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDeEIsSUFBSSxJQUFJLENBQUMsYUFBYTtnQkFDcEIsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM1QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDN0Q7UUFDRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3JC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QUM7UUFDbkIsSUFBSSxDQUFDLElBQUk7WUFDUCxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUNuQixJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsTUFBTSxHQUFHLElBQUksQ0FBQztZQUNkLEtBQUssR0FBRyxFQUFFLENBQUM7U0FDWjtRQUNELElBQUksTUFBTSxHQUFHLGdCQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ25DLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ25FLGNBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDMUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDM0MsQ0FBQztJQUVELFFBQVE7UUFDTixPQUFPLElBQUksQ0FBQyxRQUFRLEVBQVksQ0FBQztJQUNuQyxDQUFDO0NBQ0Y7QUFqR0QsMEJBaUdDIiwiZmlsZSI6Im5vZGVfbW9kdWxlcy9AZHIvaHR0cC1yZXF1ZXN0LXByb3h5L2lzb20vZGlyLXRyZWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJhc2ljYWxseSBpdCBpcyBhIGNvcHkgb2YgcmVxdWlyZS1pbmplY3Rvci9kaXN0L2Rpci10cmVlLCBidXQgZm9yIGJyb3dzZXIgc2lkZVxuICogYW5kIG5vdCByZWxhdGVkIHRvIGxvY2FsIGZpbGUgc3lzdGVtLCBhcyBhIHB1cmUgZGF0YSBzdHJ1Y3R1cmVcbiAqL1xuXG5pbXBvcnQgX2hhcyBmcm9tICdsb2Rhc2gvaGFzJztcbmltcG9ydCBfcmVwZWF0IGZyb20gJ2xvZGFzaC9yZXBlYXQnO1xuaW1wb3J0IF9lYWNoIGZyb20gJ2xvZGFzaC9lYWNoJztcblxuZXhwb3J0IGludGVyZmFjZSBUcmVlTm9kZTxUPiB7XG4gIG1hcDoge1tjaGlsZDogc3RyaW5nXTogVHJlZU5vZGU8VD59O1xuICBuYW1lOiBzdHJpbmc7XG4gIGRhdGE/OiBUO1xufVxuZXhwb3J0IGNsYXNzIERpclRyZWU8VD4ge1xuICByb290OiBUcmVlTm9kZTxUPiA9IHttYXA6IHt9LCBuYW1lOiAnJ307XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjYXNlU2Vuc2l0aXZlID0gZmFsc2UpIHt9XG5cbiAgcHV0RGF0YShwYXRoOiBzdHJpbmcsIGRhdGE6IFQpIHtcbiAgICB2YXIgdHJlZSA9IHRoaXMuZW5zdXJlTm9kZShwYXRoKTtcbiAgICB0cmVlLmRhdGEgPSBkYXRhO1xuICB9XG5cbiAgZ2V0RGF0YShwYXRoOiBzdHJpbmcpOiBUIHtcbiAgICB2YXIgdHJlZSA9IHRoaXMuZmluZE5vZGUocGF0aCk7XG4gICAgcmV0dXJuIHRyZWUgPyB0cmVlLmRhdGEgOiBudWxsO1xuICB9XG5cbiAgLyoqXG5cdCAqIEByZXR1cm4gQXJyYXkgb2YgZGF0YVxuXHQgKi9cbiAgZ2V0QWxsRGF0YShwYXRoOiBzdHJpbmcgfCBzdHJpbmdbXSk6IFRbXSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGgpKSB7XG4gICAgICBpZiAodGhpcy5jYXNlU2Vuc2l0aXZlKVxuICAgICAgICBwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsRGF0YShwYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKS5zcGxpdCgnLycpKTtcbiAgICB9XG4gICAgdmFyIHRyZWUgPSB0aGlzLnJvb3Q7XG4gICAgdmFyIGRhdGFzOiBUW10gPSBbXTtcbiAgICBpZiAoX2hhcyh0cmVlLCAnZGF0YScpKVxuICAgICAgZGF0YXMucHVzaCh0cmVlLmRhdGEpO1xuICAgIHBhdGguZXZlcnkobmFtZSA9PiB7XG4gICAgICBpZiAoX2hhcyh0cmVlLCBbJ21hcCcsIG5hbWVdKSkge1xuICAgICAgICB0cmVlID0gdHJlZS5tYXBbbmFtZV07XG4gICAgICAgIGlmIChfaGFzKHRyZWUsICdkYXRhJykpXG4gICAgICAgICAgZGF0YXMucHVzaCh0cmVlLmRhdGEpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRyZWUgPSBudWxsO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICAgIHJldHVybiBkYXRhcztcbiAgfVxuXG4gIGVuc3VyZU5vZGUocGF0aDogc3RyaW5nIHwgc3RyaW5nW10pOiBUcmVlTm9kZTxUPiB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGgpKSB7XG4gICAgICBpZiAodGhpcy5jYXNlU2Vuc2l0aXZlKVxuICAgICAgICBwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuICAgICAgcmV0dXJuIHRoaXMuZW5zdXJlTm9kZShwYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKS5zcGxpdCgnLycpKTtcbiAgICB9XG4gICAgdmFyIHRyZWUgPSB0aGlzLnJvb3Q7XG4gICAgX2VhY2gocGF0aCwgbmFtZSA9PiB7XG4gICAgICBpZiAoX2hhcyh0cmVlLCBbJ21hcCcsIG5hbWVdKSkge1xuICAgICAgICB0cmVlID0gdHJlZS5tYXBbbmFtZV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY2hpbGQgPSB7bWFwOiB7fSwgbmFtZX07XG4gICAgICAgIHRyZWUubWFwW25hbWVdID0gY2hpbGQ7XG4gICAgICAgIHRyZWUgPSBjaGlsZDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gdHJlZTtcbiAgfVxuXG4gIGZpbmROb2RlKHBhdGg6IHN0cmluZyB8IHN0cmluZ1tdKTogVHJlZU5vZGU8VD4ge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShwYXRoKSkge1xuICAgICAgaWYgKHRoaXMuY2FzZVNlbnNpdGl2ZSlcbiAgICAgICAgcGF0aCA9IHBhdGgudG9Mb3dlckNhc2UoKTtcbiAgICAgIHJldHVybiB0aGlzLmZpbmROb2RlKHBhdGgucmVwbGFjZSgvXFxcXC9nLCAnLycpLnNwbGl0KCcvJykpO1xuICAgIH1cbiAgICB2YXIgdHJlZSA9IHRoaXMucm9vdDtcbiAgICBwYXRoLmV2ZXJ5KG5hbWUgPT4ge1xuICAgICAgaWYgKF9oYXModHJlZSwgWydtYXAnLCBuYW1lXSkpIHtcbiAgICAgICAgdHJlZSA9IHRyZWUubWFwW25hbWVdO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRyZWUgPSBudWxsO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICAgIHJldHVybiB0cmVlO1xuICB9XG5cbiAgdHJhdmVyc2UobGV2ZWw6IG51bWJlciA9IDAsIHRyZWU/OiBUcmVlTm9kZTxUPiwgbGluZXM/OiBzdHJpbmdbXSkge1xuICAgIHZhciBpc1Jvb3QgPSBmYWxzZTtcbiAgICBpZiAoIXRyZWUpXG4gICAgICB0cmVlID0gdGhpcy5yb290O1xuICAgIGlmICghbGluZXMpIHtcbiAgICAgIGlzUm9vdCA9IHRydWU7XG4gICAgICBsaW5lcyA9IFtdO1xuICAgIH1cbiAgICB2YXIgaW5kZW50ID0gX3JlcGVhdCgn4pSCICAnLCBsZXZlbCk7XG4gICAgbGluZXMucHVzaChpbmRlbnQgKyAn4pSc4pSAICcgKyB0cmVlLm5hbWUgKyAodHJlZS5kYXRhID8gJyBbeF0nIDogJycpKTtcbiAgICBfZWFjaCh0cmVlLm1hcCwgKHN1YlRyZWUpID0+IHtcbiAgICAgIHRoaXMudHJhdmVyc2UobGV2ZWwgKyAxLCBzdWJUcmVlLCBsaW5lcyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGlzUm9vdCA/IGxpbmVzLmpvaW4oJ1xcbicpIDogbGluZXM7XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy50cmF2ZXJzZSgpIGFzIHN0cmluZztcbiAgfVxufVxuIl19
