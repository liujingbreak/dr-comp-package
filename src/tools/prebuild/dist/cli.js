"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const commander_1 = require("commander");
const package_json_1 = tslib_1.__importDefault(require("../package.json"));
const path_1 = tslib_1.__importDefault(require("path"));
const cfg = require('dr-comp-package/wfh/lib/config.js');
const logConfig = require('dr-comp-package/wfh/lib/logConfig.js');
const package_runner_1 = require("dr-comp-package/wfh/dist/package-runner");
const chalk_1 = tslib_1.__importDefault(require("chalk"));
const fs_extra_1 = tslib_1.__importDefault(require("fs-extra"));
const program = new commander_1.Command();
program.version(package_json_1.default.version);
program.option('-c, --config <config-file>', 'Read config files, if there are multiple files, the latter one overrides previous one', (curr, prev) => prev.concat(curr), []);
program.option('--prop <property-path=value as JSON | literal>', '<property-path>=<value as JSON | literal> ... directly set configuration properties, property name is lodash.set() path-like string\n e.g.\n', (curr, prev) => prev.concat(curr), []);
program.option('--secret', 'secret code for deploy to "prod" environment');
const deployCmd = program.command('deploy <env> <app> [scripts-file#function]')
    .option('--static', 'as an static resource build', true)
    .action((env, app, scriptsFile) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    yield cfg.init({ c: program.opts().config.length === 0 ? undefined : program.opts().config });
    logConfig(cfg());
    // console.log(Path.resolve(__dirname, '_send-patch.js'));
    yield package_runner_1.runSinglePackage({
        target: path_1.default.resolve(__dirname, '_send-patch.js') + '#test',
        arguments: [deployCmd.opts().static]
    });
}));
program.usage(program.usage() + chalk_1.default.blueBright('\nPrebuild and deploy static resource to file server and compile node server side TS files'));
const githashCmd = program.command('githash')
    .option('--env', 'target environment, e.g. "local", "dev", "test", "stage", "prod", default as all environment')
    // .option('-a,--all', 'list git hash info for all environment artifacts')
    .action(() => tslib_1.__awaiter(this, void 0, void 0, function* () {
    const Artifacts = require('./artifacts');
    if (githashCmd.opts().env) {
        // tslint:disable-next-line: no-console
        console.log(yield Artifacts.stringifyListVersions(githashCmd.opts().env));
    }
    else {
        // tslint:disable-next-line: no-console
        console.log(yield Artifacts.stringifyListAllVersions());
    }
}));
// ------ send --------
const sendCmd = program.command('send <app-name> <zip-file> [secret]')
    .requiredOption('--env <local | dev | test | stage | prod>', 'Deploy target, e.g. one of  "local", "dev", "test", "stage", "prod"')
    .action((appName, zip, secret) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    yield cfg.init({ c: program.opts().config.length === 0 ? undefined : program.opts().config });
    logConfig(cfg());
    package_runner_1.prepareLazyNodeInjector({});
    require('./_send-patch').send(sendCmd.opts().env, appName, zip, program.opts().secret);
}));
sendCmd.usage(sendCmd.usage() + '\nSend static resource to remote server');
// ------ mockzip --------
const mockzipCmd = program.command('mockzip');
mockzipCmd.option('-d', 'create a mock zip file in specific directory');
mockzipCmd.action(() => tslib_1.__awaiter(this, void 0, void 0, function* () {
    yield cfg.init({ c: program.opts().config.length === 0 ? undefined : program.opts().config });
    logConfig(cfg());
    const Artifacts = require('./artifacts');
    const fileContent = '' + new Date().toUTCString();
    const file = mockzipCmd.opts().d ? mockzipCmd.opts().d : cfg.resolve('destDir', 'prebuild-mock.zip');
    fs_extra_1.default.mkdirpSync(cfg.resolve('destDir'));
    yield Artifacts.writeMockZip(file, fileContent);
    // tslint:disable-next-line: no-console
    console.log('Mock zip:', file);
}));
program.parseAsync(process.argv);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9AYmsvcHJlYnVpbGQvdHMvY2xpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHlDQUFrQztBQUNsQywyRUFBaUM7QUFDakMsd0RBQXdCO0FBRXhCLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxtQ0FBbUMsQ0FBc0IsQ0FBQztBQUM5RSxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQztBQUNsRSw0RUFBa0c7QUFHbEcsMERBQTBCO0FBQzFCLGdFQUEwQjtBQUUxQixNQUFNLE9BQU8sR0FBRyxJQUFJLG1CQUFPLEVBQUUsQ0FBQztBQUU5QixPQUFPLENBQUMsT0FBTyxDQUFDLHNCQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDNUIsT0FBTyxDQUFDLE1BQU0sQ0FBQyw0QkFBNEIsRUFDekMsdUZBQXVGLEVBQ3ZGLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFjLENBQUMsQ0FBQztBQUNyRCxPQUFPLENBQUMsTUFBTSxDQUFDLGdEQUFnRCxFQUM3RCw4SUFBOEksRUFDOUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQWMsQ0FBQyxDQUFDO0FBQ3JELE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLDhDQUE4QyxDQUFDLENBQUM7QUFFM0UsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0Q0FBNEMsQ0FBQztLQUM5RSxNQUFNLENBQUMsVUFBVSxFQUFFLDZCQUE2QixFQUFFLElBQUksQ0FBQztLQUN2RCxNQUFNLENBQUMsQ0FBTyxHQUFHLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxFQUFFO0lBQ3RDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBbUIsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQzFHLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2pCLDBEQUEwRDtJQUMxRCxNQUFNLGlDQUFnQixDQUFDO1FBQ3JCLE1BQU0sRUFBRSxjQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxnQkFBZ0IsQ0FBQyxHQUFHLE9BQU87UUFDM0QsU0FBUyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQztLQUNyQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBQ0gsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsZUFBSyxDQUFDLFVBQVUsQ0FDNUMsNEZBQTRGLENBQUMsQ0FBQyxDQUFDO0FBRW5HLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO0tBQzVDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsOEZBQThGLENBQUM7SUFDaEgsMEVBQTBFO0tBQ3pFLE1BQU0sQ0FBQyxHQUFTLEVBQUU7SUFDakIsTUFBTSxTQUFTLEdBQXNCLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUM1RCxJQUFJLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLEVBQUU7UUFDekIsdUNBQXVDO1FBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxTQUFTLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDM0U7U0FBTTtRQUNMLHVDQUF1QztRQUN2QyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sU0FBUyxDQUFDLHdCQUF3QixFQUFFLENBQUMsQ0FBQztLQUN6RDtBQUNILENBQUMsQ0FBQSxDQUFDLENBQUM7QUFFSCx1QkFBdUI7QUFDdkIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxxQ0FBcUMsQ0FBQztLQUNyRSxjQUFjLENBQUMsMkNBQTJDLEVBQUUscUVBQXFFLENBQUM7S0FDbEksTUFBTSxDQUFDLENBQU8sT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRTtJQUNyQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUcsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLE1BQW1CLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUMxRyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNqQix3Q0FBdUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUUzQixPQUFPLENBQUMsZUFBZSxDQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDeEcsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUNILE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLHlDQUF5QyxDQUFDLENBQUM7QUFFM0UsMEJBQTBCO0FBQzFCLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDOUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsOENBQThDLENBQUMsQ0FBQztBQUN4RSxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQVMsRUFBRTtJQUMzQixNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUcsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLE1BQW1CLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUMxRyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNqQixNQUFNLFNBQVMsR0FBc0IsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBRTVELE1BQU0sV0FBVyxHQUFHLEVBQUUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBRWxELE1BQU0sSUFBSSxHQUFHLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLG1CQUFtQixDQUFDLENBQUM7SUFDckcsa0JBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBRXRDLE1BQU0sU0FBUyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDaEQsdUNBQXVDO0lBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ2pDLENBQUMsQ0FBQSxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyIsImZpbGUiOiJub2RlX21vZHVsZXMvQGJrL3ByZWJ1aWxkL2Rpc3QvY2xpLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21tYW5kfSBmcm9tICdjb21tYW5kZXInO1xuaW1wb3J0IHBrIGZyb20gJy4uL3BhY2thZ2UuanNvbic7XG5pbXBvcnQgUGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBhcGkgZnJvbSAnX19hcGknO1xuY29uc3QgY2ZnID0gcmVxdWlyZSgnZHItY29tcC1wYWNrYWdlL3dmaC9saWIvY29uZmlnLmpzJykgYXMgdHlwZW9mIGFwaS5jb25maWc7XG5jb25zdCBsb2dDb25maWcgPSByZXF1aXJlKCdkci1jb21wLXBhY2thZ2Uvd2ZoL2xpYi9sb2dDb25maWcuanMnKTtcbmltcG9ydCB7cnVuU2luZ2xlUGFja2FnZSwgcHJlcGFyZUxhenlOb2RlSW5qZWN0b3J9IGZyb20gJ2RyLWNvbXAtcGFja2FnZS93ZmgvZGlzdC9wYWNrYWdlLXJ1bm5lcic7XG5pbXBvcnQgKiBhcyBfQXJ0aWZhY3RzIGZyb20gJy4vYXJ0aWZhY3RzJztcbmltcG9ydCAqIGFzIHNwIGZyb20gJy4vX3NlbmQtcGF0Y2gnO1xuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XG5cbmNvbnN0IHByb2dyYW0gPSBuZXcgQ29tbWFuZCgpO1xuXG5wcm9ncmFtLnZlcnNpb24ocGsudmVyc2lvbik7XG5wcm9ncmFtLm9wdGlvbignLWMsIC0tY29uZmlnIDxjb25maWctZmlsZT4nLFxuICAnUmVhZCBjb25maWcgZmlsZXMsIGlmIHRoZXJlIGFyZSBtdWx0aXBsZSBmaWxlcywgdGhlIGxhdHRlciBvbmUgb3ZlcnJpZGVzIHByZXZpb3VzIG9uZScsXG4gIChjdXJyLCBwcmV2KSA9PiBwcmV2LmNvbmNhdChjdXJyKSwgW10gYXMgc3RyaW5nW10pO1xucHJvZ3JhbS5vcHRpb24oJy0tcHJvcCA8cHJvcGVydHktcGF0aD12YWx1ZSBhcyBKU09OIHwgbGl0ZXJhbD4nLFxuICAnPHByb3BlcnR5LXBhdGg+PTx2YWx1ZSBhcyBKU09OIHwgbGl0ZXJhbD4gLi4uIGRpcmVjdGx5IHNldCBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMsIHByb3BlcnR5IG5hbWUgaXMgbG9kYXNoLnNldCgpIHBhdGgtbGlrZSBzdHJpbmdcXG4gZS5nLlxcbicsXG4gIChjdXJyLCBwcmV2KSA9PiBwcmV2LmNvbmNhdChjdXJyKSwgW10gYXMgc3RyaW5nW10pO1xucHJvZ3JhbS5vcHRpb24oJy0tc2VjcmV0JywgJ3NlY3JldCBjb2RlIGZvciBkZXBsb3kgdG8gXCJwcm9kXCIgZW52aXJvbm1lbnQnKTtcblxuY29uc3QgZGVwbG95Q21kID0gcHJvZ3JhbS5jb21tYW5kKCdkZXBsb3kgPGVudj4gPGFwcD4gW3NjcmlwdHMtZmlsZSNmdW5jdGlvbl0nKVxuLm9wdGlvbignLS1zdGF0aWMnLCAnYXMgYW4gc3RhdGljIHJlc291cmNlIGJ1aWxkJywgdHJ1ZSlcbi5hY3Rpb24oYXN5bmMgKGVudiwgYXBwLCBzY3JpcHRzRmlsZSkgPT4ge1xuICBhd2FpdCBjZmcuaW5pdCh7YzogKHByb2dyYW0ub3B0cygpLmNvbmZpZyBhcyBzdHJpbmdbXSkubGVuZ3RoID09PSAwID8gdW5kZWZpbmVkIDogcHJvZ3JhbS5vcHRzKCkuY29uZmlnfSk7XG4gIGxvZ0NvbmZpZyhjZmcoKSk7XG4gIC8vIGNvbnNvbGUubG9nKFBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdfc2VuZC1wYXRjaC5qcycpKTtcbiAgYXdhaXQgcnVuU2luZ2xlUGFja2FnZSh7XG4gICAgdGFyZ2V0OiBQYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnX3NlbmQtcGF0Y2guanMnKSArICcjdGVzdCcsXG4gICAgYXJndW1lbnRzOiBbZGVwbG95Q21kLm9wdHMoKS5zdGF0aWNdXG4gIH0pO1xufSk7XG5wcm9ncmFtLnVzYWdlKHByb2dyYW0udXNhZ2UoKSArIGNoYWxrLmJsdWVCcmlnaHQoXG4gICAgJ1xcblByZWJ1aWxkIGFuZCBkZXBsb3kgc3RhdGljIHJlc291cmNlIHRvIGZpbGUgc2VydmVyIGFuZCBjb21waWxlIG5vZGUgc2VydmVyIHNpZGUgVFMgZmlsZXMnKSk7XG5cbmNvbnN0IGdpdGhhc2hDbWQgPSBwcm9ncmFtLmNvbW1hbmQoJ2dpdGhhc2gnKVxuLm9wdGlvbignLS1lbnYnLCAndGFyZ2V0IGVudmlyb25tZW50LCBlLmcuIFwibG9jYWxcIiwgXCJkZXZcIiwgXCJ0ZXN0XCIsIFwic3RhZ2VcIiwgXCJwcm9kXCIsIGRlZmF1bHQgYXMgYWxsIGVudmlyb25tZW50Jylcbi8vIC5vcHRpb24oJy1hLC0tYWxsJywgJ2xpc3QgZ2l0IGhhc2ggaW5mbyBmb3IgYWxsIGVudmlyb25tZW50IGFydGlmYWN0cycpXG4uYWN0aW9uKGFzeW5jICgpID0+IHtcbiAgY29uc3QgQXJ0aWZhY3RzOiB0eXBlb2YgX0FydGlmYWN0cyA9IHJlcXVpcmUoJy4vYXJ0aWZhY3RzJyk7XG4gIGlmIChnaXRoYXNoQ21kLm9wdHMoKS5lbnYpIHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLWNvbnNvbGVcbiAgICBjb25zb2xlLmxvZyhhd2FpdCBBcnRpZmFjdHMuc3RyaW5naWZ5TGlzdFZlcnNpb25zKGdpdGhhc2hDbWQub3B0cygpLmVudikpO1xuICB9IGVsc2Uge1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tY29uc29sZVxuICAgIGNvbnNvbGUubG9nKGF3YWl0IEFydGlmYWN0cy5zdHJpbmdpZnlMaXN0QWxsVmVyc2lvbnMoKSk7XG4gIH1cbn0pO1xuXG4vLyAtLS0tLS0gc2VuZCAtLS0tLS0tLVxuY29uc3Qgc2VuZENtZCA9IHByb2dyYW0uY29tbWFuZCgnc2VuZCA8YXBwLW5hbWU+IDx6aXAtZmlsZT4gW3NlY3JldF0nKVxuLnJlcXVpcmVkT3B0aW9uKCctLWVudiA8bG9jYWwgfCBkZXYgfCB0ZXN0IHwgc3RhZ2UgfCBwcm9kPicsICdEZXBsb3kgdGFyZ2V0LCBlLmcuIG9uZSBvZiAgXCJsb2NhbFwiLCBcImRldlwiLCBcInRlc3RcIiwgXCJzdGFnZVwiLCBcInByb2RcIicpXG4uYWN0aW9uKGFzeW5jIChhcHBOYW1lLCB6aXAsIHNlY3JldCkgPT4ge1xuICBhd2FpdCBjZmcuaW5pdCh7YzogKHByb2dyYW0ub3B0cygpLmNvbmZpZyBhcyBzdHJpbmdbXSkubGVuZ3RoID09PSAwID8gdW5kZWZpbmVkIDogcHJvZ3JhbS5vcHRzKCkuY29uZmlnfSk7XG4gIGxvZ0NvbmZpZyhjZmcoKSk7XG4gIHByZXBhcmVMYXp5Tm9kZUluamVjdG9yKHt9KTtcblxuICAocmVxdWlyZSgnLi9fc2VuZC1wYXRjaCcpIGFzIHR5cGVvZiBzcCkuc2VuZChzZW5kQ21kLm9wdHMoKS5lbnYsIGFwcE5hbWUsIHppcCwgcHJvZ3JhbS5vcHRzKCkuc2VjcmV0KTtcbn0pO1xuc2VuZENtZC51c2FnZShzZW5kQ21kLnVzYWdlKCkgKyAnXFxuU2VuZCBzdGF0aWMgcmVzb3VyY2UgdG8gcmVtb3RlIHNlcnZlcicpO1xuXG4vLyAtLS0tLS0gbW9ja3ppcCAtLS0tLS0tLVxuY29uc3QgbW9ja3ppcENtZCA9IHByb2dyYW0uY29tbWFuZCgnbW9ja3ppcCcpO1xubW9ja3ppcENtZC5vcHRpb24oJy1kJywgJ2NyZWF0ZSBhIG1vY2sgemlwIGZpbGUgaW4gc3BlY2lmaWMgZGlyZWN0b3J5Jyk7XG5tb2NremlwQ21kLmFjdGlvbihhc3luYyAoKSA9PiB7XG4gIGF3YWl0IGNmZy5pbml0KHtjOiAocHJvZ3JhbS5vcHRzKCkuY29uZmlnIGFzIHN0cmluZ1tdKS5sZW5ndGggPT09IDAgPyB1bmRlZmluZWQgOiBwcm9ncmFtLm9wdHMoKS5jb25maWd9KTtcbiAgbG9nQ29uZmlnKGNmZygpKTtcbiAgY29uc3QgQXJ0aWZhY3RzOiB0eXBlb2YgX0FydGlmYWN0cyA9IHJlcXVpcmUoJy4vYXJ0aWZhY3RzJyk7XG5cbiAgY29uc3QgZmlsZUNvbnRlbnQgPSAnJyArIG5ldyBEYXRlKCkudG9VVENTdHJpbmcoKTtcblxuICBjb25zdCBmaWxlID0gbW9ja3ppcENtZC5vcHRzKCkuZCA/IG1vY2t6aXBDbWQub3B0cygpLmQgOiBjZmcucmVzb2x2ZSgnZGVzdERpcicsICdwcmVidWlsZC1tb2NrLnppcCcpO1xuICBmcy5ta2RpcnBTeW5jKGNmZy5yZXNvbHZlKCdkZXN0RGlyJykpO1xuXG4gIGF3YWl0IEFydGlmYWN0cy53cml0ZU1vY2taaXAoZmlsZSwgZmlsZUNvbnRlbnQpO1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLWNvbnNvbGVcbiAgY29uc29sZS5sb2coJ01vY2sgemlwOicsIGZpbGUpO1xufSk7XG5cbnByb2dyYW0ucGFyc2VBc3luYyhwcm9jZXNzLmFyZ3YpO1xuIl19
