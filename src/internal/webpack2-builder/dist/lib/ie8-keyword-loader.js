"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const _ = tslib_1.__importStar(require("lodash"));
var acorn = require('acorn');
var acornjsx = require('acorn-jsx/inject')(acorn);
var acornImpInject = require('acorn-dynamic-import/lib/inject').default;
var estraverse = require('estraverse-fb');
acornjsx = acornImpInject(acornjsx);
const keywords = {};
var keywordList = ['break', 'case', 'catch', 'continue', 'default', 'delete', 'do', 'else',
    'finally', 'for', 'function', 'if', 'in', 'instanceof', 'new', 'return',
    'switch', 'this', 'throw', 'try', 'typeof', 'var', 'void', 'while', 'with',
    'abstract', 'boolean', 'byte', 'char', 'class', 'const', 'debugger',
    'double', 'enum', 'export', 'extends', 'final', 'float', 'goto',
    'implements', 'import', 'int', 'interface', 'long', 'native', 'package',
    'private', 'protected', 'public', 'short', 'static', 'super',
    'synchronized', 'throws', 'transient', 'volatile', 'null'];
keywordList.forEach((word) => keywords[word] = true);
module.exports = function (content, map, ast) {
    var callback = this.async();
    if (!callback)
        throw new Error('api-loader is Not a sync loader!');
    loadAsync(content, this, ast)
        .then(({ content, ast }) => callback(null, content, map, ast))
        .catch((err) => {
        this.emitError(err);
        callback(err);
    });
};
function loadAsync(content, loader, ast) {
    // if (!ast) {
    try {
        ast = acornjsx.parse(content, { allowHashBang: true, plugins: { jsx: true, dynamicImport: true },
            sourceType: 'module' });
    }
    catch (err) {
        ast = acornjsx.parse(content, { allowHashBang: true, plugins: { jsx: true, dynamicImport: true } });
    }
    // }
    if (!ast.replacements)
        ast.replacements = [];
    estraverse.traverse(ast, {
        enter(node, parent) {
            if (node.type === 'MemberExpression' && _.get(node, 'property.type') === 'Identifier' &&
                _.has(keywords, node.property.name)) {
                ast.replacements.push({
                    start: node.property.start - 1,
                    end: node.property.end,
                    replacement: `["${node.property.name}"]`
                });
            }
        },
        leave(node, parent) {
        },
        keys: {
            Import: [], JSXText: []
        }
    });
    var optReplace = loader.query.replace;
    if (optReplace == null || optReplace === true) {
        content = replaceCode(content, ast.replacements);
    }
    return Promise.resolve({ content, ast });
}
function replaceCode(text, replacements) {
    replacements.sort(function (a, b) {
        return a.start - b.start;
    });
    var offset = 0;
    return replacements.reduce(function (text, update) {
        var start = update.start + offset;
        var end = update.end + offset;
        var replacement = update.replacement;
        offset += (replacement.length - (end - start));
        return text.slice(0, start) + replacement + text.slice(end);
    }, text);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9AZHItY29yZS93ZWJwYWNrMi1idWlsZGVyL3RzL2xpYi9pZTgta2V5d29yZC1sb2FkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsa0RBQTRCO0FBQzVCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM3QixJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNsRCxJQUFJLGNBQWMsR0FBRyxPQUFPLENBQUMsaUNBQWlDLENBQUMsQ0FBQyxPQUFPLENBQUM7QUFDeEUsSUFBSSxVQUFVLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzFDLFFBQVEsR0FBRyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7QUFFcEMsTUFBTSxRQUFRLEdBQTJCLEVBQUUsQ0FBQztBQUU1QyxJQUFJLFdBQVcsR0FBYSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNO0lBQ3BHLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxRQUFRO0lBQ3ZFLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTTtJQUMxRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxVQUFVO0lBQ25FLFFBQVEsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU07SUFDL0QsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUs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QUFJLElBQUksVUFBVSxLQUFLLElBQUksRUFBRTtRQUM5QyxPQUFPLEdBQUcsV0FBVyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7S0FDakQ7SUFDRCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQyxPQUFPLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQztBQUN4QyxDQUFDO0FBRUQsU0FBUyxXQUFXLENBQUMsSUFBWSxFQUFFLFlBQTJCO0lBQzdELFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBUyxDQUFDLEVBQUUsQ0FBQztRQUM5QixPQUFPLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUMxQixDQUFDLENBQUMsQ0FBQztJQUNILElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNmLE9BQU8sWUFBWSxDQUFDLE1BQU0sQ0FBQyxVQUFTLElBQUksRUFBRSxNQUFNO1FBQy9DLElBQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDO1FBQ2xDLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFDO1FBQzlCLElBQUksV0FBVyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFDckMsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEdBQUcsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0QsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ1YsQ0FBQyIsImZpbGUiOiJub2RlX21vZHVsZXMvQGRyLWNvcmUvd2VicGFjazItYnVpbGRlci9kaXN0L2xpYi9pZTgta2V5d29yZC1sb2FkZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG52YXIgYWNvcm4gPSByZXF1aXJlKCdhY29ybicpO1xudmFyIGFjb3JuanN4ID0gcmVxdWlyZSgnYWNvcm4tanN4L2luamVjdCcpKGFjb3JuKTtcbnZhciBhY29ybkltcEluamVjdCA9IHJlcXVpcmUoJ2Fjb3JuLWR5bmFtaWMtaW1wb3J0L2xpYi9pbmplY3QnKS5kZWZhdWx0O1xudmFyIGVzdHJhdmVyc2UgPSByZXF1aXJlKCdlc3RyYXZlcnNlLWZiJyk7XG5hY29ybmpzeCA9IGFjb3JuSW1wSW5qZWN0KGFjb3JuanN4KTtcblxuY29uc3Qga2V5d29yZHM6IHtbazogc3RyaW5nXTogYm9vbGVhbn0gPSB7fTtcblxudmFyIGtleXdvcmRMaXN0OiBzdHJpbmdbXSA9IFsnYnJlYWsnLCAnY2FzZScsICdjYXRjaCcsICdjb250aW51ZScsICdkZWZhdWx0JywgJ2RlbGV0ZScsICdkbycsICdlbHNlJyxcbidmaW5hbGx5JywgJ2ZvcicsICdmdW5jdGlvbicsICdpZicsICdpbicsICdpbnN0YW5jZW9mJywgJ25ldycsICdyZXR1cm4nLFxuJ3N3aXRjaCcsICd0aGlzJywgJ3Rocm93JywgJ3RyeScsICd0eXBlb2YnLCAndmFyJywgJ3ZvaWQnLCAnd2hpbGUnLCAnd2l0aCcsXG4nYWJzdHJhY3QnLCAnYm9vbGVhbicsICdieXRlJywgJ2NoYXInLCAnY2xhc3MnLCAnY29uc3QnLCAnZGVidWdnZXInLFxuJ2RvdWJsZScsICdlbnVtJywgJ2V4cG9ydCcsICdleHRlbmRzJywgJ2ZpbmFsJywgJ2Zsb2F0JywgJ2dvdG8nLFxuJ2ltcGxlbWVudHMnLCAnaW1wb3J0JywgJ2ludCcsICdpbnRlcmZhY2UnLCAnbG9uZycsICduYXRpdmUnLCAncGFja2FnZScsXG4ncHJpdmF0ZScsICdwcm90ZWN0ZWQnLCAncHVibGljJywgJ3Nob3J0JywgJ3N0YXRpYycsICdzdXBlcicsXG4nc3luY2hyb25pemVkJywgJ3Rocm93cycsICd0cmFuc2llbnQnLCAndm9sYXRpbGUnLCAnbnVsbCddO1xuXG5rZXl3b3JkTGlzdC5mb3JFYWNoKCh3b3JkOiBzdHJpbmcpID0+IGtleXdvcmRzW3dvcmRdID0gdHJ1ZSk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oY29udGVudDogc3RyaW5nLCBtYXA6IGFueSwgYXN0OiB7cmVwbGFjZW1lbnRzOiBSZXBsYWNlbWVudFtdLCBbazogc3RyaW5nXTogYW55fSkge1xuXHR2YXIgY2FsbGJhY2sgPSB0aGlzLmFzeW5jKCk7XG5cdGlmICghY2FsbGJhY2spXG5cdFx0dGhyb3cgbmV3IEVycm9yKCdhcGktbG9hZGVyIGlzIE5vdCBhIHN5bmMgbG9hZGVyIScpO1xuXHRsb2FkQXN5bmMoY29udGVudCwgdGhpcywgYXN0KVxuXHQudGhlbigoe2NvbnRlbnQsIGFzdH0pID0+IGNhbGxiYWNrKG51bGwsIGNvbnRlbnQsIG1hcCwgYXN0KSlcblx0LmNhdGNoKChlcnI6IEVycm9yKSA9PiB7XG5cdFx0dGhpcy5lbWl0RXJyb3IoZXJyKTtcblx0XHRjYWxsYmFjayhlcnIpO1xuXHR9KTtcbn07XG5cbmludGVyZmFjZSBSZXBsYWNlbWVudCB7XG5cdHN0YXJ0OiBudW1iZXI7XG5cdGVuZDogbnVtYmVyO1xuXHRyZXBsYWNlbWVudDogc3RyaW5nO1xufVxuXG5mdW5jdGlvbiBsb2FkQXN5bmMoY29udGVudDogc3RyaW5nLCBsb2FkZXI6IGFueSwgYXN0OiBhbnkpOiBQcm9taXNlPHtjb250ZW50OiBzdHJpbmcsIGFzdDogYW55fT4ge1xuXHQvLyBpZiAoIWFzdCkge1xuXHR0cnkge1xuXHRcdGFzdCA9IGFjb3JuanN4LnBhcnNlKGNvbnRlbnQsIHthbGxvd0hhc2hCYW5nOiB0cnVlLCBwbHVnaW5zOiB7anN4OiB0cnVlLCBkeW5hbWljSW1wb3J0OiB0cnVlfSxcblx0XHRcdHNvdXJjZVR5cGU6ICdtb2R1bGUnfSk7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdGFzdCA9IGFjb3JuanN4LnBhcnNlKGNvbnRlbnQsIHthbGxvd0hhc2hCYW5nOiB0cnVlLCBwbHVnaW5zOiB7anN4OiB0cnVlLCBkeW5hbWljSW1wb3J0OiB0cnVlfX0pO1xuXHR9XG5cdC8vIH1cblx0aWYgKCFhc3QucmVwbGFjZW1lbnRzKVxuXHRcdGFzdC5yZXBsYWNlbWVudHMgPSBbXTtcblx0ZXN0cmF2ZXJzZS50cmF2ZXJzZShhc3QsIHtcblx0XHRlbnRlcihub2RlOiBhbnksIHBhcmVudDogYW55KSB7XG5cdFx0XHRpZiAobm9kZS50eXBlID09PSAnTWVtYmVyRXhwcmVzc2lvbicgJiYgXy5nZXQobm9kZSwgJ3Byb3BlcnR5LnR5cGUnKSA9PT0gJ0lkZW50aWZpZXInICYmXG5cdFx0XHRcdF8uaGFzKGtleXdvcmRzLCBub2RlLnByb3BlcnR5Lm5hbWUpKSB7XG5cdFx0XHRcdGFzdC5yZXBsYWNlbWVudHMucHVzaCh7XG5cdFx0XHRcdFx0c3RhcnQ6IG5vZGUucHJvcGVydHkuc3RhcnQgLSAxLCAvLyAuZGVmYXVsdCAtPiBbXCJkZWZhdWx0XCJdXG5cdFx0XHRcdFx0ZW5kOiBub2RlLnByb3BlcnR5LmVuZCxcblx0XHRcdFx0XHRyZXBsYWNlbWVudDogYFtcIiR7bm9kZS5wcm9wZXJ0eS5uYW1lfVwiXWBcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRsZWF2ZShub2RlOiBhbnksIHBhcmVudDogYW55KSB7XG5cdFx0fSxcblx0XHRrZXlzOiB7XG5cdFx0XHRJbXBvcnQ6IFtdLCBKU1hUZXh0OiBbXVxuXHRcdH1cblx0fSk7XG5cdHZhciBvcHRSZXBsYWNlOiBib29sZWFuID0gbG9hZGVyLnF1ZXJ5LnJlcGxhY2U7XG5cdGlmIChvcHRSZXBsYWNlID09IG51bGwgfHwgb3B0UmVwbGFjZSA9PT0gdHJ1ZSkge1xuXHRcdGNvbnRlbnQgPSByZXBsYWNlQ29kZShjb250ZW50LCBhc3QucmVwbGFjZW1lbnRzKTtcblx0fVxuXHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtjb250ZW50LCBhc3R9KTtcbn1cblxuZnVuY3Rpb24gcmVwbGFjZUNvZGUodGV4dDogc3RyaW5nLCByZXBsYWNlbWVudHM6IFJlcGxhY2VtZW50W10pIHtcblx0cmVwbGFjZW1lbnRzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuXHRcdHJldHVybiBhLnN0YXJ0IC0gYi5zdGFydDtcblx0fSk7XG5cdHZhciBvZmZzZXQgPSAwO1xuXHRyZXR1cm4gcmVwbGFjZW1lbnRzLnJlZHVjZShmdW5jdGlvbih0ZXh0LCB1cGRhdGUpIHtcblx0XHR2YXIgc3RhcnQgPSB1cGRhdGUuc3RhcnQgKyBvZmZzZXQ7XG5cdFx0dmFyIGVuZCA9IHVwZGF0ZS5lbmQgKyBvZmZzZXQ7XG5cdFx0dmFyIHJlcGxhY2VtZW50ID0gdXBkYXRlLnJlcGxhY2VtZW50O1xuXHRcdG9mZnNldCArPSAocmVwbGFjZW1lbnQubGVuZ3RoIC0gKGVuZCAtIHN0YXJ0KSk7XG5cdFx0cmV0dXJuIHRleHQuc2xpY2UoMCwgc3RhcnQpICsgcmVwbGFjZW1lbnQgKyB0ZXh0LnNsaWNlKGVuZCk7XG5cdH0sIHRleHQpO1xufVxuIl19
