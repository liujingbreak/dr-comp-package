"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const _ = tslib_1.__importStar(require("lodash"));
var acorn = require('acorn');
var acornjsx = require('acorn-jsx/inject')(acorn);
var acornImpInject = require('acorn-dynamic-import/lib/inject').default;
var estraverse = require('estraverse-fb');
acornjsx = acornImpInject(acornjsx);
const keywords = {};
var keywordList = ['break', 'case', 'catch', 'continue', 'default', 'delete', 'do', 'else',
    'finally', 'for', 'function', 'if', 'in', 'instanceof', 'new', 'return',
    'switch', 'this', 'throw', 'try', 'typeof', 'var', 'void', 'while', 'with',
    'abstract', 'boolean', 'byte', 'char', 'class', 'const', 'debugger',
    'double', 'enum', 'export', 'extends', 'final', 'float', 'goto',
    'implements', 'import', 'int', 'interface', 'long', 'native', 'package',
    'private', 'protected', 'public', 'short', 'static', 'super',
    'synchronized', 'throws', 'transient', 'volatile', 'null'];
keywordList.forEach((word) => keywords[word] = true);
module.exports = function (content, map, ast) {
    var callback = this.async();
    if (!callback)
        throw new Error('api-loader is Not a sync loader!');
    loadAsync(content, this, ast)
        .then(({ content, ast }) => callback(null, content, map, ast))
        .catch((err) => {
        this.emitError(err);
        callback(err);
    });
};
function loadAsync(content, loader, ast) {
    // if (!ast) {
    try {
        ast = acornjsx.parse(content, { allowHashBang: true, plugins: { jsx: true, dynamicImport: true },
            sourceType: 'module' });
    }
    catch (err) {
        ast = acornjsx.parse(content, { allowHashBang: true, plugins: { jsx: true, dynamicImport: true } });
    }
    // }
    if (!ast.replacements)
        ast.replacements = [];
    estraverse.traverse(ast, {
        enter(node, parent) {
            if (node.type === 'MemberExpression' && _.get(node, 'property.type') === 'Identifier' &&
                _.has(keywords, node.property.name)) {
                ast.replacements.push({
                    start: node.property.start - 1,
                    end: node.property.end,
                    replacement: `["${node.property.name}"]`
                });
            }
        },
        leave(node, parent) {
        },
        keys: {
            Import: [], JSXText: []
        }
    });
    var optReplace = loader.query.replace;
    if (optReplace == null || optReplace === true) {
        content = replaceCode(content, ast.replacements);
    }
    return Promise.resolve({ content, ast });
}
function replaceCode(text, replacements) {
    replacements.sort(function (a, b) {
        return a.start - b.start;
    });
    var offset = 0;
    return replacements.reduce(function (text, update) {
        var start = update.start + offset;
        var end = update.end + offset;
        var replacement = update.replacement;
        offset += (replacement.length - (end - start));
        return text.slice(0, start) + replacement + text.slice(end);
    }, text);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9AZHItY29yZS93ZWJwYWNrMi1idWlsZGVyL3RzL2xpYi9pZTgta2V5d29yZC1sb2FkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsa0RBQTRCO0FBQzVCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM3QixJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNsRCxJQUFJLGNBQWMsR0FBRyxPQUFPLENBQUMsaUNBQWlDLENBQUMsQ0FBQyxPQUFPLENBQUM7QUFDeEUsSUFBSSxVQUFVLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzFDLFFBQVEsR0FBRyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7QUFFcEMsTUFBTSxRQUFRLEdBQTJCLEVBQUUsQ0FBQztBQUU1QyxJQUFJLFdBQVcsR0FBYSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNO0lBQ3BHLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxRQUFRO0lBQ3ZFLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTTtJQUMxRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxVQUFVO0lBQ25FLFFBQVEsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU07SUFDL0QsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUs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SUFBSSxJQUFJLFVBQVUsS0FBSyxJQUFJLEVBQUU7UUFDN0MsT0FBTyxHQUFHLFdBQVcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO0tBQ2xEO0lBQ0QsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUMsT0FBTyxFQUFFLEdBQUcsRUFBQyxDQUFDLENBQUM7QUFDekMsQ0FBQztBQUVELFNBQVMsV0FBVyxDQUFDLElBQVksRUFBRSxZQUEyQjtJQUM1RCxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVMsQ0FBQyxFQUFFLENBQUM7UUFDN0IsT0FBTyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFDSCxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDZixPQUFPLFlBQVksQ0FBQyxNQUFNLENBQUMsVUFBUyxJQUFJLEVBQUUsTUFBTTtRQUM5QyxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztRQUNsQyxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQztRQUM5QixJQUFJLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO1FBQ3JDLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMvQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxHQUFHLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzlELENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNYLENBQUMiLCJmaWxlIjoibm9kZV9tb2R1bGVzL0Bkci1jb3JlL3dlYnBhY2syLWJ1aWxkZXIvZGlzdC9saWIvaWU4LWtleXdvcmQtbG9hZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xudmFyIGFjb3JuID0gcmVxdWlyZSgnYWNvcm4nKTtcbnZhciBhY29ybmpzeCA9IHJlcXVpcmUoJ2Fjb3JuLWpzeC9pbmplY3QnKShhY29ybik7XG52YXIgYWNvcm5JbXBJbmplY3QgPSByZXF1aXJlKCdhY29ybi1keW5hbWljLWltcG9ydC9saWIvaW5qZWN0JykuZGVmYXVsdDtcbnZhciBlc3RyYXZlcnNlID0gcmVxdWlyZSgnZXN0cmF2ZXJzZS1mYicpO1xuYWNvcm5qc3ggPSBhY29ybkltcEluamVjdChhY29ybmpzeCk7XG5cbmNvbnN0IGtleXdvcmRzOiB7W2s6IHN0cmluZ106IGJvb2xlYW59ID0ge307XG5cbnZhciBrZXl3b3JkTGlzdDogc3RyaW5nW10gPSBbJ2JyZWFrJywgJ2Nhc2UnLCAnY2F0Y2gnLCAnY29udGludWUnLCAnZGVmYXVsdCcsICdkZWxldGUnLCAnZG8nLCAnZWxzZScsXG4nZmluYWxseScsICdmb3InLCAnZnVuY3Rpb24nLCAnaWYnLCAnaW4nLCAnaW5zdGFuY2VvZicsICduZXcnLCAncmV0dXJuJyxcbidzd2l0Y2gnLCAndGhpcycsICd0aHJvdycsICd0cnknLCAndHlwZW9mJywgJ3ZhcicsICd2b2lkJywgJ3doaWxlJywgJ3dpdGgnLFxuJ2Fic3RyYWN0JywgJ2Jvb2xlYW4nLCAnYnl0ZScsICdjaGFyJywgJ2NsYXNzJywgJ2NvbnN0JywgJ2RlYnVnZ2VyJyxcbidkb3VibGUnLCAnZW51bScsICdleHBvcnQnLCAnZXh0ZW5kcycsICdmaW5hbCcsICdmbG9hdCcsICdnb3RvJyxcbidpbXBsZW1lbnRzJywgJ2ltcG9ydCcsICdpbnQnLCAnaW50ZXJmYWNlJywgJ2xvbmcnLCAnbmF0aXZlJywgJ3BhY2thZ2UnLFxuJ3ByaXZhdGUnLCAncHJvdGVjdGVkJywgJ3B1YmxpYycsICdzaG9ydCcsICdzdGF0aWMnLCAnc3VwZXInLFxuJ3N5bmNocm9uaXplZCcsICd0aHJvd3MnLCAndHJhbnNpZW50JywgJ3ZvbGF0aWxlJywgJ251bGwnXTtcblxua2V5d29yZExpc3QuZm9yRWFjaCgod29yZDogc3RyaW5nKSA9PiBrZXl3b3Jkc1t3b3JkXSA9IHRydWUpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGNvbnRlbnQ6IHN0cmluZywgbWFwOiBhbnksIGFzdDoge3JlcGxhY2VtZW50czogUmVwbGFjZW1lbnRbXSwgW2s6IHN0cmluZ106IGFueX0pIHtcbiAgdmFyIGNhbGxiYWNrID0gdGhpcy5hc3luYygpO1xuICBpZiAoIWNhbGxiYWNrKVxuICAgIHRocm93IG5ldyBFcnJvcignYXBpLWxvYWRlciBpcyBOb3QgYSBzeW5jIGxvYWRlciEnKTtcbiAgbG9hZEFzeW5jKGNvbnRlbnQsIHRoaXMsIGFzdClcbiAgLnRoZW4oKHtjb250ZW50LCBhc3R9KSA9PiBjYWxsYmFjayhudWxsLCBjb250ZW50LCBtYXAsIGFzdCkpXG4gIC5jYXRjaCgoZXJyOiBFcnJvcikgPT4ge1xuICAgIHRoaXMuZW1pdEVycm9yKGVycik7XG4gICAgY2FsbGJhY2soZXJyKTtcbiAgfSk7XG59O1xuXG5pbnRlcmZhY2UgUmVwbGFjZW1lbnQge1xuICBzdGFydDogbnVtYmVyO1xuICBlbmQ6IG51bWJlcjtcbiAgcmVwbGFjZW1lbnQ6IHN0cmluZztcbn1cblxuZnVuY3Rpb24gbG9hZEFzeW5jKGNvbnRlbnQ6IHN0cmluZywgbG9hZGVyOiBhbnksIGFzdDogYW55KTogUHJvbWlzZTx7Y29udGVudDogc3RyaW5nLCBhc3Q6IGFueX0+IHtcbiAgLy8gaWYgKCFhc3QpIHtcbiAgdHJ5IHtcbiAgICBhc3QgPSBhY29ybmpzeC5wYXJzZShjb250ZW50LCB7YWxsb3dIYXNoQmFuZzogdHJ1ZSwgcGx1Z2luczoge2pzeDogdHJ1ZSwgZHluYW1pY0ltcG9ydDogdHJ1ZX0sXG4gICAgICBzb3VyY2VUeXBlOiAnbW9kdWxlJ30pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBhc3QgPSBhY29ybmpzeC5wYXJzZShjb250ZW50LCB7YWxsb3dIYXNoQmFuZzogdHJ1ZSwgcGx1Z2luczoge2pzeDogdHJ1ZSwgZHluYW1pY0ltcG9ydDogdHJ1ZX19KTtcbiAgfVxuICAvLyB9XG4gIGlmICghYXN0LnJlcGxhY2VtZW50cylcbiAgICBhc3QucmVwbGFjZW1lbnRzID0gW107XG4gIGVzdHJhdmVyc2UudHJhdmVyc2UoYXN0LCB7XG4gICAgZW50ZXIobm9kZTogYW55LCBwYXJlbnQ6IGFueSkge1xuICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ01lbWJlckV4cHJlc3Npb24nICYmIF8uZ2V0KG5vZGUsICdwcm9wZXJ0eS50eXBlJykgPT09ICdJZGVudGlmaWVyJyAmJlxuICAgICAgICBfLmhhcyhrZXl3b3Jkcywgbm9kZS5wcm9wZXJ0eS5uYW1lKSkge1xuICAgICAgICBhc3QucmVwbGFjZW1lbnRzLnB1c2goe1xuICAgICAgICAgIHN0YXJ0OiBub2RlLnByb3BlcnR5LnN0YXJ0IC0gMSwgLy8gLmRlZmF1bHQgLT4gW1wiZGVmYXVsdFwiXVxuICAgICAgICAgIGVuZDogbm9kZS5wcm9wZXJ0eS5lbmQsXG4gICAgICAgICAgcmVwbGFjZW1lbnQ6IGBbXCIke25vZGUucHJvcGVydHkubmFtZX1cIl1gXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbGVhdmUobm9kZTogYW55LCBwYXJlbnQ6IGFueSkge1xuICAgIH0sXG4gICAga2V5czoge1xuICAgICAgSW1wb3J0OiBbXSwgSlNYVGV4dDogW11cbiAgICB9XG4gIH0pO1xuICB2YXIgb3B0UmVwbGFjZTogYm9vbGVhbiA9IGxvYWRlci5xdWVyeS5yZXBsYWNlO1xuICBpZiAob3B0UmVwbGFjZSA9PSBudWxsIHx8IG9wdFJlcGxhY2UgPT09IHRydWUpIHtcbiAgICBjb250ZW50ID0gcmVwbGFjZUNvZGUoY29udGVudCwgYXN0LnJlcGxhY2VtZW50cyk7XG4gIH1cbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7Y29udGVudCwgYXN0fSk7XG59XG5cbmZ1bmN0aW9uIHJlcGxhY2VDb2RlKHRleHQ6IHN0cmluZywgcmVwbGFjZW1lbnRzOiBSZXBsYWNlbWVudFtdKSB7XG4gIHJlcGxhY2VtZW50cy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICByZXR1cm4gYS5zdGFydCAtIGIuc3RhcnQ7XG4gIH0pO1xuICB2YXIgb2Zmc2V0ID0gMDtcbiAgcmV0dXJuIHJlcGxhY2VtZW50cy5yZWR1Y2UoZnVuY3Rpb24odGV4dCwgdXBkYXRlKSB7XG4gICAgdmFyIHN0YXJ0ID0gdXBkYXRlLnN0YXJ0ICsgb2Zmc2V0O1xuICAgIHZhciBlbmQgPSB1cGRhdGUuZW5kICsgb2Zmc2V0O1xuICAgIHZhciByZXBsYWNlbWVudCA9IHVwZGF0ZS5yZXBsYWNlbWVudDtcbiAgICBvZmZzZXQgKz0gKHJlcGxhY2VtZW50Lmxlbmd0aCAtIChlbmQgLSBzdGFydCkpO1xuICAgIHJldHVybiB0ZXh0LnNsaWNlKDAsIHN0YXJ0KSArIHJlcGxhY2VtZW50ICsgdGV4dC5zbGljZShlbmQpO1xuICB9LCB0ZXh0KTtcbn1cbiJdfQ==
