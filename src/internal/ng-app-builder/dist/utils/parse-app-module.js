"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const ts = tslib_1.__importStar(require("typescript"));
const typescript_1 = require("typescript");
const _ = tslib_1.__importStar(require("lodash"));
const patch_text_1 = tslib_1.__importDefault(require("./patch-text"));
const Path = tslib_1.__importStar(require("path"));
const fs = tslib_1.__importStar(require("fs"));
class EsImportStatement {
    constructor(from, start, end) {
        this.from = from;
        this.start = start;
        this.end = end;
        this.isDynamic = false;
    }
    asNameToRealName(asName) {
        const idxOfDot = asName.indexOf('.');
        if (idxOfDot > 0) {
            asName = asName.substring(0, idxOfDot);
        }
        if (this.defaultName === asName)
            return asName;
        else if (this.nameBinding && _.has(this.nameBinding, asName)) {
            return this.nameBinding[asName];
        }
        else if (asName === this.namespace) {
            return this.namespace;
        }
        throw new Error(`No "${asName}" found in import statement from "${this.from}"`);
    }
}
exports.EsImportStatement = EsImportStatement;
exports.findAppModuleFileFromMain = _.memoize(_findAppModuleFileFromMain);
function _findAppModuleFileFromMain(mainFile) {
    const lookupPath = ['AppModule', 'AppServerModule'];
    while (true) {
        const found = findFileByExportNames(mainFile, ...lookupPath);
        if (found == null || found.size === 0) {
            throw new Error('Can not found "AppModule" or "AppServerModule from ' + mainFile);
        }
        if (found.has(lookupPath[0])) {
            let target = Path.resolve(Path.dirname(mainFile), found.get(lookupPath[0]));
            if (!target.endsWith('.ts'))
                target = target + '.ts';
            return target;
        }
        if (found.has(lookupPath[1])) {
            mainFile = Path.resolve(Path.dirname(mainFile), found.get(lookupPath[1]));
            if (!mainFile.endsWith('.ts'))
                mainFile += '.ts';
        }
    }
}
function findFileByExportNames(file, ...importName) {
    const srcfile = ts.createSourceFile(file, fs.readFileSync(file, 'utf8'), ts.ScriptTarget.ESNext, true, ts.ScriptKind.TSX);
    const res = new Map();
    for (const stm of srcfile.statements) {
        if (stm.kind === typescript_1.SyntaxKind.ImportDeclaration && _.has(stm, 'importClause.namedBindings')) {
            const binding = stm.importClause.namedBindings;
            const found = _.intersection(binding.elements.map(el => el.name.text), importName);
            if (found && found.length > 0) {
                const appModuleFile = stm.moduleSpecifier.text;
                found.forEach(importName => res.set(importName, appModuleFile));
                break;
            }
        }
        else if (stm.kind === typescript_1.SyntaxKind.ExportDeclaration && stm.exportClause) {
            const binding = stm.exportClause;
            const found = _.intersection(binding.elements.map(el => el.name.text), importName);
            if (found && found.length > 0) {
                const appModuleFile = stm.moduleSpecifier.text;
                found.forEach(importName => res.set(importName, appModuleFile));
                break;
            }
        }
    }
    return res;
}
// tslint:disable max-classes-per-file
class AppModuleParser {
    constructor() {
        this.esImportsMap = new Map(); // key is imported name
        // modulesToAddSet: Set<string>; // in form of  <package name>#<export name>
        this.modulesToAdd = [];
    }
    /**
     *
     * @param file file path
     * @param fileContent file content
     * @param removableModules array of <ES module path>#<export name>, e.g. @foo/bar/src/module#DocRoute
     * @param modulesToAdd array of <ES module path>#<export name>, e.g. @foo/bar/src/module#DocRoute
     * @param importAppComponent e.g. @foo/bar/src/module#AppComponent
     */
    patchFile(file, fileContent, removableModules, modulesToAdd) {
        this.fileContent = fileContent;
        this.file = file;
        this.dynamicModuleSet = new Set(removableModules);
        for (const add of new Set(modulesToAdd).values()) {
            this.modulesToAdd.push(this.moduleInfoFromStr(add));
        }
        this.replacements = [];
        this.sourceFile = ts.createSourceFile(file, fileContent, ts.ScriptTarget.ESNext, true, ts.ScriptKind.TSX);
        for (const stm of this.sourceFile.statements) {
            this.traverseTsAst(stm);
        }
        return patch_text_1.default(fileContent, this.replacements);
    }
    findEsImportByName(name) {
        const lookup = name.indexOf('.') > 0 ? name.split('.')[0].trim() : name;
        return this.esImportsMap.get(lookup);
    }
    /**
     * 1. Remember those NgModule imports which are not removable
     *   (neither removable nor Typescript Identifier/CallExpression)
     * 2. Remove ES import statement which are removable
     * 3. Add new ES import statement
     * 4. Replace whole NgModule imports arrary with those not removables and newly added
     * @param ngImportArrayExp
     */
    checkAndPatch(ngImportArrayExp) {
        const keepImportEl = new Set(); // 1. Remember those NgModule imports which are not removable
        for (const el of ngImportArrayExp.elements) {
            let exp;
            if (el.kind === typescript_1.SyntaxKind.Identifier) {
                exp = el.text;
            }
            else if (el.kind === typescript_1.SyntaxKind.CallExpression) {
                exp = el.expression.getText(this.sourceFile);
            }
            else {
                keepImportEl.add(el.getText(this.sourceFile));
                continue;
            }
            const esImport = this.findEsImportByName(exp);
            const realName = esImport.asNameToRealName(exp);
            if (esImport.from.startsWith('@angular/')) {
                keepImportEl.add(el.getText(this.sourceFile));
                continue;
            }
            else if (this.dynamicModuleSet.has(esImport.from + '#' + realName)) {
                if (!esImport.isDynamic) {
                    // 2. Remove ES import statement which are removable
                    this.replacements.push({ start: esImport.start, end: esImport.end, text: '' });
                    esImport.isDynamic = true;
                }
            }
            else {
                keepImportEl.add(el.getText(this.sourceFile));
            }
        }
        // 3. Add new ES import statement
        this.appendNgImports();
        let i = 0;
        // 4. Replace whole NgModule imports arrary with those not removables and newly added
        const wholeNgImports = Array.from(keepImportEl.values());
        // wholeNgImports.unshift(...this.modulesToAdd.map(m => m.exportName + '_' + i++));
        const insertPos = wholeNgImports.findIndex(value => /^\s*RouterModule\s*\.\s*forRoot\(/.test(value));
        wholeNgImports.splice(insertPos, 0, ...this.modulesToAdd.map(m => m.exportName + '_' + i++));
        this.replacements.push({
            start: ngImportArrayExp.getStart(this.sourceFile),
            end: ngImportArrayExp.getEnd(),
            text: '[\n    ' + wholeNgImports.join(',\n    ') + '  ]'
        });
    }
    traverseTsAst(ast, level = 0) {
        if (ast.kind === typescript_1.SyntaxKind.ImportDeclaration) {
            const node = ast;
            const from = node.moduleSpecifier.text;
            const importInfo = new EsImportStatement(from, node.getStart(this.sourceFile, false), node.getEnd());
            this.esImportsMap.set(from, importInfo);
            if (_.get(node, 'importClause.name')) {
                importInfo.defaultName = node.importClause.name.text;
                this.esImportsMap.set(importInfo.defaultName, importInfo);
            }
            if (_.get(node, 'importClause.namedBindings')) {
                const nb = node.importClause.namedBindings;
                if (nb.kind === typescript_1.SyntaxKind.NamespaceImport) {
                    importInfo.namespace = nb.name.text;
                    this.esImportsMap.set(importInfo.namespace, importInfo);
                }
                else {
                    importInfo.nameBinding = {};
                    nb.elements.forEach(element => {
                        importInfo.nameBinding[element.name.text] = element.propertyName ? element.propertyName.text : element.name.text;
                        this.esImportsMap.set(element.name.text, importInfo);
                    });
                }
            }
            this.lastEsImportEndPos = ast.getEnd();
            // console.log(importInfo);
            return;
        }
        else if (ast.kind === typescript_1.SyntaxKind.Decorator && ast.expression.kind === typescript_1.SyntaxKind.CallExpression) {
            const exp = ast.expression;
            if (exp.expression.text === 'NgModule') {
                const notation = exp.arguments[0];
                const ngImports = notation.properties.find(el => el.name.text === 'imports');
                if (ngImports.kind !== typescript_1.SyntaxKind.PropertyAssignment) {
                    throw new Error('@NgModule\' property "imports" must be plain PropertyAssignment expression');
                }
                const importArrayExp = ngImports.initializer;
                this.checkAndPatch(importArrayExp);
                return;
            }
        }
        ast.forEachChild((sub) => {
            this.traverseTsAst(sub, level + 1);
        });
    }
    appendNgImports() {
        let i = 0;
        let newEsImport = '\n';
        const esImportMap = new Map();
        for (const add of this.modulesToAdd) {
            // this.replacements.push({start: pos, end: pos, text: `, ${add.exportName}_${i++}`});
            let fromModule = esImportMap.get(add.moduleName);
            if (fromModule == null) {
                fromModule = new Set();
                esImportMap.set(add.moduleName, fromModule);
            }
            fromModule.add(add.exportName);
        }
        i = 0;
        for (const fromModule of esImportMap.entries()) {
            // tslint:disable max-line-length
            newEsImport += `import {${Array.from(fromModule[1].values()).map((name) => `${name} as ${name}_${i++}`).join(', ')}} from '${fromModule[0]}';\n`;
        }
        this.replacements.push({ start: this.lastEsImportEndPos, end: this.lastEsImportEndPos, text: newEsImport });
    }
    moduleInfoFromStr(desc) {
        const idxHyph = desc.indexOf('#');
        const moduleName = desc.substring(0, idxHyph);
        const exportName = desc.substring(idxHyph + 1);
        if (!desc.startsWith('.')) {
            return { moduleName, exportName };
        }
        return {
            moduleName: Path.relative(Path.dirname(this.file), moduleName).replace(/\\/g, '/'),
            exportName
        };
    }
}
exports.default = AppModuleParser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9AZHItY29yZS9uZy1hcHAtYnVpbGRlci90cy91dGlscy9wYXJzZS1hcHAtbW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHVEQUFpQztBQUNqQywyQ0FBNEM7QUFDNUMsa0RBQTRCO0FBQzVCLHNFQUF5RDtBQUN6RCxtREFBNkI7QUFDN0IsK0NBQXlCO0FBRXpCLE1BQWEsaUJBQWlCO0lBTTdCLFlBQW1CLElBQVksRUFBUyxLQUFhLEVBQVMsR0FBVztRQUF0RCxTQUFJLEdBQUosSUFBSSxDQUFRO1FBQVMsVUFBSyxHQUFMLEtBQUssQ0FBUTtRQUFTLFFBQUcsR0FBSCxHQUFHLENBQVE7UUFGekUsY0FBUyxHQUFHLEtBQUssQ0FBQztJQUUwRCxDQUFDO0lBRTdFLGdCQUFnQixDQUFDLE1BQWM7UUFDOUIsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQyxJQUFJLFFBQVEsR0FBRyxDQUFDLEVBQUU7WUFDakIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQ3ZDO1FBQ0QsSUFBSSxJQUFJLENBQUMsV0FBVyxLQUFLLE1BQU07WUFDOUIsT0FBTyxNQUFNLENBQUM7YUFDVixJQUFJLElBQUksQ0FBQyxXQUFXLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQzdELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNoQzthQUFNLElBQUksTUFBTSxLQUFLLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDckMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO1NBQ3RCO1FBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLE1BQU0scUNBQXFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO0lBQ2pGLENBQUM7Q0FDRDtB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QUFFLFdBQVcsRUFBQyxDQUFDLENBQUM7SUFDM0csQ0FBQztJQUVTLGlCQUFpQixDQUFDLElBQVk7UUFDdkMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM5QyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUMxQixPQUFPLEVBQUMsVUFBVSxFQUFFLFVBQVUsRUFBQyxDQUFDO1NBQ2hDO1FBQ0QsT0FBTztZQUNOLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDO1lBQ2xGLFVBQVU7U0FDVixDQUFDO0lBQ0gsQ0FBQztDQUNEO0FBL0tELGtDQStLQyIsImZpbGUiOiJub2RlX21vZHVsZXMvQGRyLWNvcmUvbmctYXBwLWJ1aWxkZXIvZGlzdC91dGlscy9wYXJzZS1hcHAtbW9kdWxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgdHMgZnJvbSAndHlwZXNjcmlwdCc7XG5pbXBvcnQge1N5bnRheEtpbmQgYXMgc2t9IGZyb20gJ3R5cGVzY3JpcHQnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHJlcGxhY2VDb2RlLCB7UmVwbGFjZW1lbnRJbmZ9IGZyb20gJy4vcGF0Y2gtdGV4dCc7XG5pbXBvcnQgKiBhcyBQYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuXG5leHBvcnQgY2xhc3MgRXNJbXBvcnRTdGF0ZW1lbnQge1xuXHRkZWZhdWx0TmFtZT86IHN0cmluZztcblx0bmFtZXNwYWNlPzogc3RyaW5nO1xuXHRuYW1lQmluZGluZz86IHtbYXM6IHN0cmluZ106IHN0cmluZ307IC8vIGtleSBpcyBcImFzXCIsIHZhbHVlIGlzIG9yaWdpbmFsIG5hbWVcblx0aXNEeW5hbWljID0gZmFsc2U7XG5cblx0Y29uc3RydWN0b3IocHVibGljIGZyb206IHN0cmluZywgcHVibGljIHN0YXJ0OiBudW1iZXIsIHB1YmxpYyBlbmQ6IG51bWJlcikge31cblxuXHRhc05hbWVUb1JlYWxOYW1lKGFzTmFtZTogc3RyaW5nKSB7XG5cdFx0Y29uc3QgaWR4T2ZEb3QgPSBhc05hbWUuaW5kZXhPZignLicpO1xuXHRcdGlmIChpZHhPZkRvdCA+IDApIHtcblx0XHRcdGFzTmFtZSA9IGFzTmFtZS5zdWJzdHJpbmcoMCwgaWR4T2ZEb3QpO1xuXHRcdH1cblx0XHRpZiAodGhpcy5kZWZhdWx0TmFtZSA9PT0gYXNOYW1lKVxuXHRcdFx0cmV0dXJuIGFzTmFtZTtcblx0XHRlbHNlIGlmICh0aGlzLm5hbWVCaW5kaW5nICYmIF8uaGFzKHRoaXMubmFtZUJpbmRpbmcsIGFzTmFtZSkpIHtcblx0XHRcdHJldHVybiB0aGlzLm5hbWVCaW5kaW5nW2FzTmFtZV07XG5cdFx0fSBlbHNlIGlmIChhc05hbWUgPT09IHRoaXMubmFtZXNwYWNlKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5uYW1lc3BhY2U7XG5cdFx0fVxuXHRcdHRocm93IG5ldyBFcnJvcihgTm8gXCIke2FzTmFtZX1cIiBmb3VuZCBpbiBpbXBvcnQgc3RhdGVtZW50IGZyb20gXCIke3RoaXMuZnJvbX1cImApO1xuXHR9XG59XG5leHBvcnQgY29uc3QgZmluZEFwcE1vZHVsZUZpbGVGcm9tTWFpbiA9IF8ubWVtb2l6ZShfZmluZEFwcE1vZHVsZUZpbGVGcm9tTWFpbik7XG5cbmZ1bmN0aW9uIF9maW5kQXBwTW9kdWxlRmlsZUZyb21NYWluKG1haW5GaWxlOiBzdHJpbmcpOiBzdHJpbmcge1xuXHRjb25zdCBsb29rdXBQYXRoID0gWydBcHBNb2R1bGUnLCAnQXBwU2VydmVyTW9kdWxlJ107XG5cdHdoaWxlICh0cnVlKSB7XG5cdFx0Y29uc3QgZm91bmQgPSBmaW5kRmlsZUJ5RXhwb3J0TmFtZXMobWFpbkZpbGUsIC4uLmxvb2t1cFBhdGgpO1xuXHRcdGlmIChmb3VuZCA9PSBudWxsIHx8IGZvdW5kLnNpemUgPT09IDApIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcignQ2FuIG5vdCBmb3VuZCBcIkFwcE1vZHVsZVwiIG9yIFwiQXBwU2VydmVyTW9kdWxlIGZyb20gJyArIG1haW5GaWxlKTtcblx0XHR9XG5cdFx0aWYgKGZvdW5kLmhhcyhsb29rdXBQYXRoWzBdKSkge1xuXHRcdFx0bGV0IHRhcmdldCA9IFBhdGgucmVzb2x2ZShQYXRoLmRpcm5hbWUobWFpbkZpbGUpLCBmb3VuZC5nZXQobG9va3VwUGF0aFswXSkpO1xuXHRcdFx0aWYgKCF0YXJnZXQuZW5kc1dpdGgoJy50cycpKVxuXHRcdFx0XHR0YXJnZXQgPSB0YXJnZXQgKyAnLnRzJztcblx0XHRcdHJldHVybiB0YXJnZXQ7XG5cdFx0fVxuXHRcdGlmIChmb3VuZC5oYXMobG9va3VwUGF0aFsxXSkpIHtcblx0XHRcdG1haW5GaWxlID0gUGF0aC5yZXNvbHZlKFBhdGguZGlybmFtZShtYWluRmlsZSksIGZvdW5kLmdldChsb29rdXBQYXRoWzFdKSk7XG5cdFx0XHRpZiAoIW1haW5GaWxlLmVuZHNXaXRoKCcudHMnKSlcblx0XHRcdFx0bWFpbkZpbGUgKz0gJy50cyc7XG5cdFx0fVxuXHR9XG59XG5cbmZ1bmN0aW9uIGZpbmRGaWxlQnlFeHBvcnROYW1lcyhmaWxlOiBzdHJpbmcsIC4uLmltcG9ydE5hbWU6IHN0cmluZ1tdKTogTWFwPHN0cmluZywgc3RyaW5nPiB7XG5cdGNvbnN0IHNyY2ZpbGUgPSB0cy5jcmVhdGVTb3VyY2VGaWxlKGZpbGUsIGZzLnJlYWRGaWxlU3luYyhmaWxlLCAndXRmOCcpLCB0cy5TY3JpcHRUYXJnZXQuRVNOZXh0LFxuXHRcdHRydWUsIHRzLlNjcmlwdEtpbmQuVFNYKTtcblx0Y29uc3QgcmVzOiBNYXA8c3RyaW5nLCBzdHJpbmc+ID0gbmV3IE1hcCgpO1xuXHRmb3IoY29uc3Qgc3RtIG9mIHNyY2ZpbGUuc3RhdGVtZW50cykge1xuXHRcdGlmIChzdG0ua2luZCA9PT0gc2suSW1wb3J0RGVjbGFyYXRpb24gJiYgXy5oYXMoc3RtLCAnaW1wb3J0Q2xhdXNlLm5hbWVkQmluZGluZ3MnKSkge1xuXHRcdFx0Y29uc3QgYmluZGluZyA9IChzdG0gYXMgdHMuSW1wb3J0RGVjbGFyYXRpb24pLmltcG9ydENsYXVzZS5uYW1lZEJpbmRpbmdzIGFzIHRzLk5hbWVkSW1wb3J0cztcblx0XHRcdGNvbnN0IGZvdW5kID0gXy5pbnRlcnNlY3Rpb24oYmluZGluZy5lbGVtZW50cy5tYXAoZWwgPT4gZWwubmFtZS50ZXh0KSwgaW1wb3J0TmFtZSk7XG5cdFx0XHRpZiAoZm91bmQgJiYgZm91bmQubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBhcHBNb2R1bGVGaWxlID0gKChzdG0gYXMgdHMuSW1wb3J0RGVjbGFyYXRpb24pLm1vZHVsZVNwZWNpZmllciBhcyB0cy5TdHJpbmdMaXRlcmFsKS50ZXh0O1xuXHRcdFx0XHRmb3VuZC5mb3JFYWNoKGltcG9ydE5hbWUgPT4gcmVzLnNldChpbXBvcnROYW1lLCBhcHBNb2R1bGVGaWxlKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZiAoc3RtLmtpbmQgPT09IHNrLkV4cG9ydERlY2xhcmF0aW9uICYmIChzdG0gYXMgdHMuRXhwb3J0RGVjbGFyYXRpb24pLmV4cG9ydENsYXVzZSkge1xuXHRcdFx0Y29uc3QgYmluZGluZyA9IChzdG0gYXMgdHMuRXhwb3J0RGVjbGFyYXRpb24pLmV4cG9ydENsYXVzZTtcblx0XHRcdGNvbnN0IGZvdW5kID0gXy5pbnRlcnNlY3Rpb24oYmluZGluZy5lbGVtZW50cy5tYXAoZWwgPT4gZWwubmFtZS50ZXh0KSwgaW1wb3J0TmFtZSk7XG5cdFx0XHRpZiAoZm91bmQgJiYgZm91bmQubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBhcHBNb2R1bGVGaWxlID0gKChzdG0gYXMgdHMuRXhwb3J0RGVjbGFyYXRpb24pLm1vZHVsZVNwZWNpZmllciBhcyB0cy5TdHJpbmdMaXRlcmFsKS50ZXh0O1xuXHRcdFx0XHRmb3VuZC5mb3JFYWNoKGltcG9ydE5hbWUgPT4gcmVzLnNldChpbXBvcnROYW1lLCBhcHBNb2R1bGVGaWxlKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzO1xufVxuLy8gdHNsaW50OmRpc2FibGUgbWF4LWNsYXNzZXMtcGVyLWZpbGVcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwcE1vZHVsZVBhcnNlciB7XG5cblx0ZmlsZTogc3RyaW5nO1xuXHRlc0ltcG9ydHNNYXA6IE1hcDxzdHJpbmcsIEVzSW1wb3J0U3RhdGVtZW50PiA9IG5ldyBNYXAoKTsgLy8ga2V5IGlzIGltcG9ydGVkIG5hbWVcblx0ZHluYW1pY01vZHVsZVNldDogU2V0PHN0cmluZz47IC8vIGluIGZvcm0gb2YgIDxwYWNrYWdlIG5hbWU+IzxleHBvcnQgbmFtZT5cblx0Ly8gbW9kdWxlc1RvQWRkU2V0OiBTZXQ8c3RyaW5nPjsgLy8gaW4gZm9ybSBvZiAgPHBhY2thZ2UgbmFtZT4jPGV4cG9ydCBuYW1lPlxuXHRtb2R1bGVzVG9BZGQ6IEFycmF5PHttb2R1bGVOYW1lOiBzdHJpbmcsIGV4cG9ydE5hbWU6IHN0cmluZ30+ID0gW107XG5cdHJlcGxhY2VtZW50czogUmVwbGFjZW1lbnRJbmZbXTtcblx0bGFzdEVzSW1wb3J0RW5kUG9zOiBudW1iZXI7IC8vIFRoZSBlbmQgcG9zaXRpb24gb2YgbGFzdCBgaW1wb3J0YCBzdGF0ZW1lbnQsIHdlJ3JlIGdvaW5ndG8gaW5zZXJ0IG5ldyBhZnRlciBpdC5cblxuXHRmaWxlQ29udGVudDogc3RyaW5nO1xuXHRzb3VyY2VGaWxlOiB0cy5Tb3VyY2VGaWxlO1xuXG5cdC8qKlxuXHQgKiBcblx0ICogQHBhcmFtIGZpbGUgZmlsZSBwYXRoXG5cdCAqIEBwYXJhbSBmaWxlQ29udGVudCBmaWxlIGNvbnRlbnRcblx0ICogQHBhcmFtIHJlbW92YWJsZU1vZHVsZXMgYXJyYXkgb2YgPEVTIG1vZHVsZSBwYXRoPiM8ZXhwb3J0IG5hbWU+LCBlLmcuIEBmb28vYmFyL3NyYy9tb2R1bGUjRG9jUm91dGVcblx0ICogQHBhcmFtIG1vZHVsZXNUb0FkZCBhcnJheSBvZiA8RVMgbW9kdWxlIHBhdGg+IzxleHBvcnQgbmFtZT4sIGUuZy4gQGZvby9iYXIvc3JjL21vZHVsZSNEb2NSb3V0ZVxuXHQgKiBAcGFyYW0gaW1wb3J0QXBwQ29tcG9uZW50IGUuZy4gQGZvby9iYXIvc3JjL21vZHVsZSNBcHBDb21wb25lbnRcblx0ICovXG5cdHBhdGNoRmlsZShmaWxlOiBzdHJpbmcsIGZpbGVDb250ZW50OiBzdHJpbmcsIHJlbW92YWJsZU1vZHVsZXM6IHN0cmluZ1tdLCBtb2R1bGVzVG9BZGQ6IHN0cmluZ1tdKSB7XG5cdFx0dGhpcy5maWxlQ29udGVudCA9IGZpbGVDb250ZW50O1xuXHRcdHRoaXMuZmlsZSA9IGZpbGU7XG5cblx0XHR0aGlzLmR5bmFtaWNNb2R1bGVTZXQgPSBuZXcgU2V0KHJlbW92YWJsZU1vZHVsZXMpO1xuXHRcdGZvciAoY29uc3QgYWRkIG9mIG5ldyBTZXQobW9kdWxlc1RvQWRkKS52YWx1ZXMoKSkge1xuXHRcdFx0dGhpcy5tb2R1bGVzVG9BZGQucHVzaCh0aGlzLm1vZHVsZUluZm9Gcm9tU3RyKGFkZCkpO1xuXHRcdH1cblx0XHR0aGlzLnJlcGxhY2VtZW50cyA9IFtdO1xuXG5cdFx0dGhpcy5zb3VyY2VGaWxlID0gdHMuY3JlYXRlU291cmNlRmlsZShmaWxlLCBmaWxlQ29udGVudCwgdHMuU2NyaXB0VGFyZ2V0LkVTTmV4dCxcblx0XHRcdHRydWUsIHRzLlNjcmlwdEtpbmQuVFNYKTtcblx0XHRmb3IoY29uc3Qgc3RtIG9mIHRoaXMuc291cmNlRmlsZS5zdGF0ZW1lbnRzKSB7XG5cdFx0XHR0aGlzLnRyYXZlcnNlVHNBc3Qoc3RtKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcmVwbGFjZUNvZGUoZmlsZUNvbnRlbnQsIHRoaXMucmVwbGFjZW1lbnRzKTtcblx0fVxuXG5cdHByb3RlY3RlZCBmaW5kRXNJbXBvcnRCeU5hbWUobmFtZTogc3RyaW5nKTogRXNJbXBvcnRTdGF0ZW1lbnQge1xuXHRcdGNvbnN0IGxvb2t1cCA9IG5hbWUuaW5kZXhPZignLicpID4gMCA/IG5hbWUuc3BsaXQoJy4nKVswXS50cmltKCkgOiBuYW1lO1xuXHRcdHJldHVybiB0aGlzLmVzSW1wb3J0c01hcC5nZXQobG9va3VwKTtcblx0fVxuXG5cdC8qKlxuXHQgKiAxLiBSZW1lbWJlciB0aG9zZSBOZ01vZHVsZSBpbXBvcnRzIHdoaWNoIGFyZSBub3QgcmVtb3ZhYmxlXG5cdCAqICAgKG5laXRoZXIgcmVtb3ZhYmxlIG5vciBUeXBlc2NyaXB0IElkZW50aWZpZXIvQ2FsbEV4cHJlc3Npb24pXG5cdCAqIDIuIFJlbW92ZSBFUyBpbXBvcnQgc3RhdGVtZW50IHdoaWNoIGFyZSByZW1vdmFibGVcblx0ICogMy4gQWRkIG5ldyBFUyBpbXBvcnQgc3RhdGVtZW50XG5cdCAqIDQuIFJlcGxhY2Ugd2hvbGUgTmdNb2R1bGUgaW1wb3J0cyBhcnJhcnkgd2l0aCB0aG9zZSBub3QgcmVtb3ZhYmxlcyBhbmQgbmV3bHkgYWRkZWRcblx0ICogQHBhcmFtIG5nSW1wb3J0QXJyYXlFeHBcblx0ICovXG5cdHByb3RlY3RlZCBjaGVja0FuZFBhdGNoKG5nSW1wb3J0QXJyYXlFeHA6IHRzLkFycmF5TGl0ZXJhbEV4cHJlc3Npb24pIHtcblx0XHRjb25zdCBrZWVwSW1wb3J0RWw6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpOyAvLyAxLiBSZW1lbWJlciB0aG9zZSBOZ01vZHVsZSBpbXBvcnRzIHdoaWNoIGFyZSBub3QgcmVtb3ZhYmxlXG5cdFx0Zm9yIChjb25zdCBlbCBvZiBuZ0ltcG9ydEFycmF5RXhwLmVsZW1lbnRzKSB7XG5cdFx0XHRsZXQgZXhwOiBzdHJpbmc7XG5cdFx0XHRpZiAoZWwua2luZCA9PT0gc2suSWRlbnRpZmllcikge1xuXHRcdFx0XHRleHAgPSAoZWwgYXMgdHMuSWRlbnRpZmllcikudGV4dDtcblx0XHRcdH0gZWxzZSBpZiAoZWwua2luZCA9PT0gc2suQ2FsbEV4cHJlc3Npb24pIHtcblx0XHRcdFx0ZXhwID0gKGVsIGFzIHRzLkNhbGxFeHByZXNzaW9uKS5leHByZXNzaW9uLmdldFRleHQodGhpcy5zb3VyY2VGaWxlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGtlZXBJbXBvcnRFbC5hZGQoZWwuZ2V0VGV4dCh0aGlzLnNvdXJjZUZpbGUpKTtcblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9XG5cdFx0XHRjb25zdCBlc0ltcG9ydCA9IHRoaXMuZmluZEVzSW1wb3J0QnlOYW1lKGV4cCk7XG5cdFx0XHRjb25zdCByZWFsTmFtZSA9IGVzSW1wb3J0LmFzTmFtZVRvUmVhbE5hbWUoZXhwKTtcblx0XHRcdGlmIChlc0ltcG9ydC5mcm9tLnN0YXJ0c1dpdGgoJ0Bhbmd1bGFyLycpKSB7XG5cdFx0XHRcdGtlZXBJbXBvcnRFbC5hZGQoZWwuZ2V0VGV4dCh0aGlzLnNvdXJjZUZpbGUpKTtcblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuZHluYW1pY01vZHVsZVNldC5oYXMoZXNJbXBvcnQuZnJvbSArICcjJyArIHJlYWxOYW1lKSkge1xuXHRcdFx0XHRpZiAoIWVzSW1wb3J0LmlzRHluYW1pYykge1xuXHRcdFx0XHRcdC8vIDIuIFJlbW92ZSBFUyBpbXBvcnQgc3RhdGVtZW50IHdoaWNoIGFyZSByZW1vdmFibGVcblx0XHRcdFx0XHR0aGlzLnJlcGxhY2VtZW50cy5wdXNoKHtzdGFydDogZXNJbXBvcnQuc3RhcnQsIGVuZDogZXNJbXBvcnQuZW5kLCB0ZXh0OiAnJ30pO1xuXHRcdFx0XHRcdGVzSW1wb3J0LmlzRHluYW1pYyA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGtlZXBJbXBvcnRFbC5hZGQoZWwuZ2V0VGV4dCh0aGlzLnNvdXJjZUZpbGUpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0Ly8gMy4gQWRkIG5ldyBFUyBpbXBvcnQgc3RhdGVtZW50XG5cdFx0dGhpcy5hcHBlbmROZ0ltcG9ydHMoKTtcblx0XHRsZXQgaSA9IDA7XG5cdFx0Ly8gNC4gUmVwbGFjZSB3aG9sZSBOZ01vZHVsZSBpbXBvcnRzIGFycmFyeSB3aXRoIHRob3NlIG5vdCByZW1vdmFibGVzIGFuZCBuZXdseSBhZGRlZFxuXHRcdGNvbnN0IHdob2xlTmdJbXBvcnRzID0gQXJyYXkuZnJvbShrZWVwSW1wb3J0RWwudmFsdWVzKCkpO1xuXHRcdC8vIHdob2xlTmdJbXBvcnRzLnVuc2hpZnQoLi4udGhpcy5tb2R1bGVzVG9BZGQubWFwKG0gPT4gbS5leHBvcnROYW1lICsgJ18nICsgaSsrKSk7XG5cdFx0Y29uc3QgaW5zZXJ0UG9zID0gd2hvbGVOZ0ltcG9ydHMuZmluZEluZGV4KHZhbHVlID0+IC9eXFxzKlJvdXRlck1vZHVsZVxccypcXC5cXHMqZm9yUm9vdFxcKC8udGVzdCh2YWx1ZSkpO1xuXHRcdHdob2xlTmdJbXBvcnRzLnNwbGljZShpbnNlcnRQb3MsIDAsIC4uLnRoaXMubW9kdWxlc1RvQWRkLm1hcChtID0+IG0uZXhwb3J0TmFtZSArICdfJyArIGkrKykpO1xuXHRcdHRoaXMucmVwbGFjZW1lbnRzLnB1c2goe1xuXHRcdFx0c3RhcnQ6IG5nSW1wb3J0QXJyYXlFeHAuZ2V0U3RhcnQodGhpcy5zb3VyY2VGaWxlKSxcblx0XHRcdGVuZDogbmdJbXBvcnRBcnJheUV4cC5nZXRFbmQoKSxcblx0XHRcdHRleHQ6ICdbXFxuICAgICcgKyB3aG9sZU5nSW1wb3J0cy5qb2luKCcsXFxuICAgICcpICsgJyAgXSdcblx0XHR9KTtcblx0fVxuXG5cdHByb3RlY3RlZCB0cmF2ZXJzZVRzQXN0KGFzdDogdHMuTm9kZSwgbGV2ZWwgPSAwKSB7XG5cdFx0aWYgKGFzdC5raW5kID09PSBzay5JbXBvcnREZWNsYXJhdGlvbikge1xuXHRcdFx0Y29uc3Qgbm9kZSA9IGFzdCBhcyB0cy5JbXBvcnREZWNsYXJhdGlvbjtcblx0XHRcdGNvbnN0IGZyb20gPSAobm9kZS5tb2R1bGVTcGVjaWZpZXIgYXMgdHMuU3RyaW5nTGl0ZXJhbCkudGV4dDtcblx0XHRcdGNvbnN0IGltcG9ydEluZm86IEVzSW1wb3J0U3RhdGVtZW50ID0gbmV3IEVzSW1wb3J0U3RhdGVtZW50KFxuXHRcdFx0XHRmcm9tLCBub2RlLmdldFN0YXJ0KHRoaXMuc291cmNlRmlsZSwgZmFsc2UpLG5vZGUuZ2V0RW5kKCkpO1xuXHRcdFx0dGhpcy5lc0ltcG9ydHNNYXAuc2V0KGZyb20sIGltcG9ydEluZm8pO1xuXG5cdFx0XHRpZiAoXy5nZXQobm9kZSwgJ2ltcG9ydENsYXVzZS5uYW1lJykpIHtcblx0XHRcdFx0aW1wb3J0SW5mby5kZWZhdWx0TmFtZSA9IG5vZGUuaW1wb3J0Q2xhdXNlLm5hbWUudGV4dDtcblx0XHRcdFx0dGhpcy5lc0ltcG9ydHNNYXAuc2V0KGltcG9ydEluZm8uZGVmYXVsdE5hbWUsIGltcG9ydEluZm8pO1xuXHRcdFx0fVxuXHRcdFx0aWYgKF8uZ2V0KG5vZGUsICdpbXBvcnRDbGF1c2UubmFtZWRCaW5kaW5ncycpKSB7XG5cdFx0XHRcdGNvbnN0IG5iID0gbm9kZS5pbXBvcnRDbGF1c2UubmFtZWRCaW5kaW5ncztcblx0XHRcdFx0aWYgKG5iLmtpbmQgPT09IHNrLk5hbWVzcGFjZUltcG9ydCkge1xuXHRcdFx0XHRcdGltcG9ydEluZm8ubmFtZXNwYWNlID0gbmIubmFtZS50ZXh0O1xuXHRcdFx0XHRcdHRoaXMuZXNJbXBvcnRzTWFwLnNldChpbXBvcnRJbmZvLm5hbWVzcGFjZSwgaW1wb3J0SW5mbyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aW1wb3J0SW5mby5uYW1lQmluZGluZyA9IHt9O1xuXHRcdFx0XHRcdG5iLmVsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiB7XG5cdFx0XHRcdFx0XHRpbXBvcnRJbmZvLm5hbWVCaW5kaW5nW2VsZW1lbnQubmFtZS50ZXh0XSA9IGVsZW1lbnQucHJvcGVydHlOYW1lID8gZWxlbWVudC5wcm9wZXJ0eU5hbWUudGV4dCA6IGVsZW1lbnQubmFtZS50ZXh0O1xuXHRcdFx0XHRcdFx0dGhpcy5lc0ltcG9ydHNNYXAuc2V0KGVsZW1lbnQubmFtZS50ZXh0LCBpbXBvcnRJbmZvKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0dGhpcy5sYXN0RXNJbXBvcnRFbmRQb3MgPSBhc3QuZ2V0RW5kKCk7XG5cdFx0XHQvLyBjb25zb2xlLmxvZyhpbXBvcnRJbmZvKTtcblx0XHRcdHJldHVybjtcblx0XHR9IGVsc2UgaWYgKGFzdC5raW5kID09PSBzay5EZWNvcmF0b3IgJiYgKGFzdCBhcyB0cy5EZWNvcmF0b3IpLmV4cHJlc3Npb24ua2luZCA9PT0gc2suQ2FsbEV4cHJlc3Npb24pIHtcblx0XHRcdGNvbnN0IGV4cCA9IChhc3QgYXMgdHMuRGVjb3JhdG9yKS5leHByZXNzaW9uIGFzIHRzLkNhbGxFeHByZXNzaW9uO1xuXHRcdFx0aWYgKChleHAuZXhwcmVzc2lvbiBhcyB0cy5JZGVudGlmaWVyKS50ZXh0ID09PSAnTmdNb2R1bGUnKSB7XG5cdFx0XHRcdGNvbnN0IG5vdGF0aW9uID0gZXhwLmFyZ3VtZW50c1swXSBhcyB0cy5PYmplY3RMaXRlcmFsRXhwcmVzc2lvbjtcblx0XHRcdFx0Y29uc3QgbmdJbXBvcnRzID0gbm90YXRpb24ucHJvcGVydGllcy5maW5kKFxuXHRcdFx0XHRcdGVsID0+IChlbC5uYW1lIGFzIHRzLklkZW50aWZpZXIpLnRleHQgPT09ICdpbXBvcnRzJyk7XG5cdFx0XHRcdGlmIChuZ0ltcG9ydHMua2luZCAhPT0gc2suUHJvcGVydHlBc3NpZ25tZW50KSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdATmdNb2R1bGVcXCcgcHJvcGVydHkgXCJpbXBvcnRzXCIgbXVzdCBiZSBwbGFpbiBQcm9wZXJ0eUFzc2lnbm1lbnQgZXhwcmVzc2lvbicpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNvbnN0IGltcG9ydEFycmF5RXhwID0gKChuZ0ltcG9ydHMgYXMgdHMuUHJvcGVydHlBc3NpZ25tZW50KS5pbml0aWFsaXplciBhcyB0cy5BcnJheUxpdGVyYWxFeHByZXNzaW9uKTtcblx0XHRcdFx0dGhpcy5jaGVja0FuZFBhdGNoKGltcG9ydEFycmF5RXhwKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRhc3QuZm9yRWFjaENoaWxkKChzdWI6IHRzLk5vZGUpID0+IHtcblx0XHRcdHRoaXMudHJhdmVyc2VUc0FzdChzdWIsIGxldmVsICsgMSk7XG5cdFx0fSk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgYXBwZW5kTmdJbXBvcnRzKCkge1xuXHRcdGxldCBpID0gMDtcblx0XHRsZXQgbmV3RXNJbXBvcnQgPSAnXFxuJztcblx0XHRjb25zdCBlc0ltcG9ydE1hcDogTWFwPHN0cmluZywgU2V0PHN0cmluZz4+ID0gbmV3IE1hcCgpO1xuXHRcdGZvciAoY29uc3QgYWRkIG9mIHRoaXMubW9kdWxlc1RvQWRkKSB7XG5cdFx0XHQvLyB0aGlzLnJlcGxhY2VtZW50cy5wdXNoKHtzdGFydDogcG9zLCBlbmQ6IHBvcywgdGV4dDogYCwgJHthZGQuZXhwb3J0TmFtZX1fJHtpKyt9YH0pO1xuXHRcdFx0bGV0IGZyb21Nb2R1bGUgPSBlc0ltcG9ydE1hcC5nZXQoYWRkLm1vZHVsZU5hbWUpO1xuXHRcdFx0aWYgKGZyb21Nb2R1bGUgPT0gbnVsbCkge1xuXHRcdFx0XHRmcm9tTW9kdWxlID0gbmV3IFNldCgpO1xuXHRcdFx0XHRlc0ltcG9ydE1hcC5zZXQoYWRkLm1vZHVsZU5hbWUsIGZyb21Nb2R1bGUpO1xuXHRcdFx0fVxuXHRcdFx0ZnJvbU1vZHVsZS5hZGQoYWRkLmV4cG9ydE5hbWUpO1xuXHRcdH1cblx0XHRpID0gMDtcblx0XHRmb3IgKGNvbnN0IGZyb21Nb2R1bGUgb2YgZXNJbXBvcnRNYXAuZW50cmllcygpKSB7XG5cdFx0XHQvLyB0c2xpbnQ6ZGlzYWJsZSBtYXgtbGluZS1sZW5ndGhcblx0XHRcdG5ld0VzSW1wb3J0ICs9IGBpbXBvcnQgeyR7QXJyYXkuZnJvbShmcm9tTW9kdWxlWzFdLnZhbHVlcygpKS5tYXAoKG5hbWUpID0+IGAke25hbWV9IGFzICR7bmFtZX1fJHtpKyt9YCkuam9pbignLCAnKX19IGZyb20gJyR7ZnJvbU1vZHVsZVswXX0nO1xcbmA7XG5cdFx0fVxuXHRcdHRoaXMucmVwbGFjZW1lbnRzLnB1c2goe3N0YXJ0OiB0aGlzLmxhc3RFc0ltcG9ydEVuZFBvcywgZW5kOiB0aGlzLmxhc3RFc0ltcG9ydEVuZFBvcywgdGV4dDogbmV3RXNJbXBvcnR9KTtcblx0fVxuXG5cdHByb3RlY3RlZCBtb2R1bGVJbmZvRnJvbVN0cihkZXNjOiBzdHJpbmcpOiB7bW9kdWxlTmFtZTogc3RyaW5nLCBleHBvcnROYW1lOiBzdHJpbmd9IHtcblx0XHRjb25zdCBpZHhIeXBoID0gZGVzYy5pbmRleE9mKCcjJyk7XG5cdFx0Y29uc3QgbW9kdWxlTmFtZSA9IGRlc2Muc3Vic3RyaW5nKDAsIGlkeEh5cGgpO1xuXHRcdGNvbnN0IGV4cG9ydE5hbWUgPSBkZXNjLnN1YnN0cmluZyhpZHhIeXBoICsgMSk7XG5cdFx0aWYgKCFkZXNjLnN0YXJ0c1dpdGgoJy4nKSkge1xuXHRcdFx0cmV0dXJuIHttb2R1bGVOYW1lLCBleHBvcnROYW1lfTtcblx0XHR9XG5cdFx0cmV0dXJuIHtcblx0XHRcdG1vZHVsZU5hbWU6IFBhdGgucmVsYXRpdmUoUGF0aC5kaXJuYW1lKHRoaXMuZmlsZSksIG1vZHVsZU5hbWUpLnJlcGxhY2UoL1xcXFwvZywgJy8nKSxcblx0XHRcdGV4cG9ydE5hbWVcblx0XHR9O1xuXHR9XG59XG4iXX0=
