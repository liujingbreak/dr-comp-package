"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* tslint:disable max-classes-per-file max-line-length no-console jsdoc-format */
const base_LLn_parser_1 = require("dr-comp-package/wfh/dist/base-LLn-parser");
var HtmlTokenType;
(function (HtmlTokenType) {
    // comments,
    HtmlTokenType[HtmlTokenType['<'] = 0] = '<';
    HtmlTokenType[HtmlTokenType['>'] = 1] = '>';
    HtmlTokenType[HtmlTokenType['('] = 2] = '(';
    HtmlTokenType[HtmlTokenType[')'] = 3] = ')';
    HtmlTokenType[HtmlTokenType['['] = 4] = '[';
    HtmlTokenType[HtmlTokenType[']'] = 5] = ']';
    HtmlTokenType[HtmlTokenType['</'] = 6] = '</';
    HtmlTokenType[HtmlTokenType['='] = 7] = '=';
    HtmlTokenType[HtmlTokenType["identity"] = 8] = "identity";
    HtmlTokenType[HtmlTokenType["stringLiteral"] = 9] = "stringLiteral";
    HtmlTokenType[HtmlTokenType["any"] = 10] = "any";
    HtmlTokenType[HtmlTokenType["space"] = 11] = "space";
})(HtmlTokenType = exports.HtmlTokenType || (exports.HtmlTokenType = {}));
exports.TokenType = HtmlTokenType;
class TemplateLexer extends base_LLn_parser_1.BaseLexer {
    *[Symbol.iterator]() {
        while (true) {
            this.skip();
            let char = this.la();
            const start = this.position;
            if (char == null) {
                return;
            }
            switch (char) {
                case '>':
                case '(':
                case ')':
                case '[':
                case ']':
                case '=':
                    this.advance();
                    yield new base_LLn_parser_1.Token(HtmlTokenType[char], this, start);
                    continue;
                default:
            }
            if (char === '<' && this.isIdStart(2)) {
                yield this.openTagStart();
            }
            else if (this.isNext('</')) {
                yield this.closeTagStart();
            }
            else if (this.isIdStart()) {
                do {
                    this.advance();
                    char = this.la();
                } while (this.isIdStart());
                yield new base_LLn_parser_1.Token(HtmlTokenType.identity, this, start);
            }
            else if (char === '"') {
                yield this.stringLit('"');
            }
            else if (char === '\'') {
                yield this.stringLit('\'');
            }
            else if (char === '`') {
                yield this.stringLit('`');
            }
            else if (this.isWhitespace()) {
                do {
                    this.advance();
                } while (this.isWhitespace());
                // yield new Token(HtmlTokenType.space, ' ');
                continue;
            }
            else {
                yield new base_LLn_parser_1.Token(HtmlTokenType.any, this, start);
                this.advance();
            }
        }
    }
    openTagStart() {
        const start = this.position;
        this.advance();
        do {
            this.advance();
        } while (this.isIdStart());
        return new base_LLn_parser_1.Token(HtmlTokenType['<'], this, start);
    }
    closeTagStart() {
        this.advance(2);
        const start = this.position;
        while (this.la() !== '>') {
            this.advance();
        }
        return new base_LLn_parser_1.Token(HtmlTokenType['</'], this, start);
    }
    isIdStart(laIdx = 1) {
        const char = this.la(laIdx);
        return /[^<>()\[\]"'=`/]/.test(char) && /\S/.test(char);
    }
    isWhitespace() {
        const chr = this.la();
        return /\s/.test(chr);
    }
    stringLit(quote) {
        this.advance();
        const start = this.position;
        while (this.la() !== quote) {
            if (this.la() == null)
                this.throwError();
            // console.log(':', this.la());
            if (this.la() === '\\') {
                this.advance();
            }
            this.advance();
        }
        const tk = new base_LLn_parser_1.Token(HtmlTokenType.stringLiteral, this, start);
        this.advance();
        return tk;
    }
    skip() {
        let chr = this.la();
        while (chr != null) {
            if (this.isComment()) {
                this.comment();
            }
            else if (this.isSwigComment()) {
                this.swigComment();
            }
            else {
                break;
            }
            chr = this.la();
        }
        return this.la();
    }
    isComment() {
        return this.isNext('<!--');
    }
    comment() {
        this.advance(4);
        while (!this.isNext('-->')) {
            if (this.la() == null)
                throw new Error('Comment is not closed, ' + this.getCurrentPosInfo());
            this.advance();
        }
        this.advance(3);
        return true;
    }
    isSwigComment() {
        return this.isNext('{#');
    }
    swigComment() {
        this.advance(2);
        while (!this.isNext('#}')) {
            this.advance();
        }
    }
}
exports.TemplateLexer = TemplateLexer;
class TemplateParser extends base_LLn_parser_1.BaseParser {
    constructor(input) {
        const lexer = new TemplateLexer(input);
        super(lexer);
        this.lexer = lexer;
    }
    getCurrentPosInfo() {
        const start = this.la() ? this.la().start : null;
        if (start) {
            const lineCol = this.lexer.getLineColumn(start);
            return `Line ${lineCol[0] + 1} column ${lineCol[1] + 1}`;
        }
    }
    skip() {
        while (this.la() != null && this.la().type === HtmlTokenType.space) {
            this.advance();
        }
    }
    parse() {
        const ast = [];
        while (this.la() != null) {
            if (this.la().type === HtmlTokenType['<']) {
                ast.push(this.tag());
            }
            else if (this.la().type === HtmlTokenType['</']) {
                this.advance();
            }
            else {
                this.advance();
            }
        }
        return ast;
    }
    tag() {
        const first = this.advance();
        const name = first.text.substring(1);
        const attrs = this.attributes();
        const last = this.advance(); // >
        return { name, attrs, start: first.start, end: last.end };
    }
    attributes() {
        const attrs = {};
        while (this.la() != null && this.la().type !== HtmlTokenType['>']) {
            if (this.isNgAttrName()) {
                const key = this.ngAttrName();
                attrs[key] = { isNg: true, value: this.attrValue() };
            }
            else if (this.la().type === HtmlTokenType.identity) {
                const key = this.attrName();
                attrs[key] = { isNg: false, value: this.attrValue() };
            }
            else {
                console.log('Previous tokens: ', this.lb().text);
                this.throwError(this.la().text);
            }
        }
        return attrs;
    }
    isNgAttrName() {
        const type = this.la().type;
        return type === HtmlTokenType['['] || type === HtmlTokenType['('];
    }
    ngAttrName() {
        const kind = this.la().type === HtmlTokenType['['] ? HtmlTokenType[']'] : HtmlTokenType[')'];
        let name;
        this.advance();
        if (this.isNgAttrName())
            name = this.ngAttrName();
        else
            name = this.attrName();
        if (this.la().type !== kind)
            this.throwError(this.la().text);
        this.advance();
        return name;
    }
    attrName() {
        return this.advance().text;
    }
    attrValue() {
        if (this.la() && this.la().type === HtmlTokenType['=']) {
            // let {text, start, end} = this.advance(2);
            // return {text, start, end};
            return this.advance(2);
        }
        else {
            return null;
        }
    }
}
exports.TemplateParser = TemplateParser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9AZHItY29yZS9uZy1hcHAtYnVpbGRlci90cy91dGlscy9uZy1odG1sLXBhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlGQUFpRjtBQUNqRiw4RUFBc0Y7QUFFdEYsSUFBWSxhQWNYO0FBZEQsV0FBWSxhQUFhO0lBQ3hCLFlBQVk7SUFDWiw0QkFBQyxHQUFHLFNBQUgsR0FBSSxDQUFBO0lBQ0wsNEJBQUMsR0FBRyxTQUFILEdBQUksQ0FBQTtJQUNMLDRCQUFDLEdBQUcsU0FBSCxHQUFJLENBQUE7SUFDTCw0QkFBQyxHQUFHLFNBQUgsR0FBSSxDQUFBO0lBQ0wsNEJBQUMsR0FBRyxTQUFILEdBQUksQ0FBQTtJQUNMLDRCQUFDLEdBQUcsU0FBSCxHQUFJLENBQUE7SUFDTCw0QkFBQyxJQUFJLFNBQUosSUFBSyxDQUFBO0lBQ04sNEJBQUMsR0FBRyxTQUFILEdBQUksQ0FBQTtJQUNMLHlEQUFRLENBQUE7SUFDUixtRUFBYSxDQUFBO0lBQ2IsZ0RBQUcsQ0FBQTtJQUNILG9EQUFLLENBQUE7QUFDTixDQUFDLEVBZFcsYUFBYSxHQUFiLHFCQUFhLEtBQWIscUJBQWEsUUFjeEI7QUFFd0Isa0NBQVM7QUFDbEMsTUFBYSxhQUFjLFNBQVEsMkJBQXdCO0lBQzFELENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1FBQ2pCLE9BQU8sSUFBSSxFQUFFO1lBQ1osSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ1osSUFBSSxJQUFJLEdBQVcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzdCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDNUIsSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFO2dCQUNqQixPQUFPO2FBQ1A7WUFDRCxRQUFRLElBQUksRUFBRTtnQkFDYixLQUFLLEdBQUcsQ0FBQztnQkFDVCxLQUFLLEdBQUcsQ0FBQztnQkFDVCxLQUFLLEdBQUcsQ0FBQztnQkFDVCxLQUFLLEdB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QUFDLElBQUksS0FBSyxhQUFhLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDdkQsNENBQTRDO1lBQzVDLDZCQUE2QjtZQUM3QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdkI7YUFBTTtZQUNOLE9BQU8sSUFBSSxDQUFDO1NBQ1o7SUFDRixDQUFDO0NBQ0Q7QUFyRkQsd0NBcUZDIiwiZmlsZSI6Im5vZGVfbW9kdWxlcy9AZHItY29yZS9uZy1hcHAtYnVpbGRlci9kaXN0L3V0aWxzL25nLWh0bWwtcGFyc2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogdHNsaW50OmRpc2FibGUgbWF4LWNsYXNzZXMtcGVyLWZpbGUgbWF4LWxpbmUtbGVuZ3RoIG5vLWNvbnNvbGUganNkb2MtZm9ybWF0ICovXG5pbXBvcnQge1Rva2VuLCBCYXNlUGFyc2VyLCBCYXNlTGV4ZXJ9IGZyb20gJ2RyLWNvbXAtcGFja2FnZS93ZmgvZGlzdC9iYXNlLUxMbi1wYXJzZXInO1xuXG5leHBvcnQgZW51bSBIdG1sVG9rZW5UeXBlIHtcblx0Ly8gY29tbWVudHMsXG5cdFsnPCddLFxuXHRbJz4nXSxcblx0WycoJ10sXG5cdFsnKSddLFxuXHRbJ1snXSxcblx0WyddJ10sXG5cdFsnPC8nXSxcblx0Wyc9J10sXG5cdGlkZW50aXR5LFxuXHRzdHJpbmdMaXRlcmFsLFxuXHRhbnksIC8vIC4qXG5cdHNwYWNlXG59XG5cbmV4cG9ydCB7SHRtbFRva2VuVHlwZSBhcyBUb2tlblR5cGV9O1xuZXhwb3J0IGNsYXNzIFRlbXBsYXRlTGV4ZXIgZXh0ZW5kcyBCYXNlTGV4ZXI8SHRtbFRva2VuVHlwZT4ge1xuXHQqW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmF0b3I8VG9rZW48SHRtbFRva2VuVHlwZT4+IHtcblx0XHR3aGlsZSAodHJ1ZSkge1xuXHRcdFx0dGhpcy5za2lwKCk7XG5cdFx0XHRsZXQgY2hhcjogc3RyaW5nID0gdGhpcy5sYSgpO1xuXHRcdFx0Y29uc3Qgc3RhcnQgPSB0aGlzLnBvc2l0aW9uO1xuXHRcdFx0aWYgKGNoYXIgPT0gbnVsbCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRzd2l0Y2ggKGNoYXIpIHtcblx0XHRcdFx0Y2FzZSAnPic6XG5cdFx0XHRcdGNhc2UgJygnOlxuXHRcdFx0XHRjYXNlICcpJzpcblx0XHRcdFx0Y2FzZSAnWyc6XG5cdFx0XHRcdGNhc2UgJ10nOlxuXHRcdFx0XHRjYXNlICc9Jzpcblx0XHRcdFx0XHR0aGlzLmFkdmFuY2UoKTtcblx0XHRcdFx0XHR5aWVsZCBuZXcgVG9rZW4oSHRtbFRva2VuVHlwZVtjaGFyXSwgdGhpcywgc3RhcnQpO1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0fVxuXHRcdFx0aWYgKGNoYXIgPT09ICc8JyAmJiB0aGlzLmlzSWRTdGFydCgyKSkge1xuXHRcdFx0XHR5aWVsZCB0aGlzLm9wZW5UYWdTdGFydCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0aGlzLmlzTmV4dCgnPC8nKSkge1xuXHRcdFx0XHR5aWVsZCB0aGlzLmNsb3NlVGFnU3RhcnQoKTtcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5pc0lkU3RhcnQoKSkge1xuXHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0dGhpcy5hZHZhbmNlKCk7XG5cdFx0XHRcdFx0Y2hhciA9IHRoaXMubGEoKTtcblx0XHRcdFx0fSB3aGlsZSAodGhpcy5pc0lkU3RhcnQoKSk7XG5cdFx0XHRcdHlpZWxkIG5ldyBUb2tlbihIdG1sVG9rZW5UeXBlLmlkZW50aXR5LCB0aGlzLCBzdGFydCk7XG5cdFx0XHR9IGVsc2UgaWYgKGNoYXIgPT09ICdcIicpIHtcblx0XHRcdFx0eWllbGQgdGhpcy5zdHJpbmdMaXQoJ1wiJyk7XG5cdFx0XHR9IGVsc2UgaWYgKGNoYXIgPT09ICdcXCcnKSB7XG5cdFx0XHRcdHlpZWxkIHRoaXMuc3RyaW5nTGl0KCdcXCcnKTtcblx0XHRcdH0gZWxzZSBpZiAoY2hhciA9PT0gJ2AnKSB7XG5cdFx0XHRcdHlpZWxkIHRoaXMuc3RyaW5nTGl0KCdgJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuaXNXaGl0ZXNwYWNlKCkpIHtcblx0XHRcdFx0ZG8ge1xuXHRcdFx0XHRcdHRoaXMuYWR2YW5jZSgpO1xuXHRcdFx0XHR9IHdoaWxlICh0aGlzLmlzV2hpdGVzcGFjZSgpKTtcblx0XHRcdFx0Ly8geWllbGQgbmV3IFRva2VuKEh0bWxUb2tlblR5cGUuc3BhY2UsICcgJyk7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0eWllbGQgbmV3IFRva2VuKEh0bWxUb2tlblR5cGUuYW55LCB0aGlzLCBzdGFydCk7XG5cdFx0XHRcdHRoaXMuYWR2YW5jZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRvcGVuVGFnU3RhcnQoKSB7XG5cdFx0Y29uc3Qgc3RhcnQgPSB0aGlzLnBvc2l0aW9uO1xuXHRcdHRoaXMuYWR2YW5jZSgpO1xuXHRcdGRvIHtcblx0XHRcdHRoaXMuYWR2YW5jZSgpO1xuXHRcdH0gd2hpbGUgKHRoaXMuaXNJZFN0YXJ0KCkpO1xuXHRcdHJldHVybiBuZXcgVG9rZW4oSHRtbFRva2VuVHlwZVsnPCddLCB0aGlzLCBzdGFydCk7XG5cdH1cblx0Y2xvc2VUYWdTdGFydCgpIHtcblx0XHR0aGlzLmFkdmFuY2UoMik7XG5cdFx0Y29uc3Qgc3RhcnQgPSB0aGlzLnBvc2l0aW9uO1xuXHRcdHdoaWxlICh0aGlzLmxhKCkgIT09ICc+Jykge1xuXHRcdFx0dGhpcy5hZHZhbmNlKCk7XG5cdFx0fVxuXHRcdHJldHVybiBuZXcgVG9rZW4oSHRtbFRva2VuVHlwZVsnPC8nXSwgdGhpcywgc3RhcnQpO1xuXHR9XG5cdGlzSWRTdGFydChsYUlkeCA9IDEpIHtcblx0XHRjb25zdCBjaGFyID0gdGhpcy5sYShsYUlkeCk7XG5cdFx0cmV0dXJuIC9bXjw+KClcXFtcXF1cIic9YC9dLy50ZXN0KGNoYXIpICYmIC9cXFMvLnRlc3QoY2hhcik7XG5cdH1cblx0aXNXaGl0ZXNwYWNlKCkge1xuXHRcdGNvbnN0IGNociA9IHRoaXMubGEoKTtcblx0XHRyZXR1cm4gL1xccy8udGVzdChjaHIpO1xuXHR9XG5cblx0c3RyaW5nTGl0KHF1b3RlOiBzdHJpbmcpIHtcblx0XHR0aGlzLmFkdmFuY2UoKTtcblx0XHRjb25zdCBzdGFydCA9IHRoaXMucG9zaXRpb247XG5cdFx0d2hpbGUgKHRoaXMubGEoKSAhPT0gcXVvdGUpIHtcblx0XHRcdGlmICh0aGlzLmxhKCkgPT0gbnVsbClcblx0XHRcdFx0dGhpcy50aHJvd0Vycm9yKCk7XG5cdFx0XHQvLyBjb25zb2xlLmxvZygnOicsIHRoaXMubGEoKSk7XG5cdFx0XHRpZiAodGhpcy5sYSgpID09PSAnXFxcXCcpIHtcblx0XHRcdFx0dGhpcy5hZHZhbmNlKCk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmFkdmFuY2UoKTtcblx0XHR9XG5cdFx0Y29uc3QgdGsgPSBuZXcgVG9rZW4oSHRtbFRva2VuVHlwZS5zdHJpbmdMaXRlcmFsLCB0aGlzLCBzdGFydCk7XG5cdFx0dGhpcy5hZHZhbmNlKCk7XG5cdFx0cmV0dXJuIHRrO1xuXHR9XG5cblx0c2tpcCgpIHtcblx0XHRsZXQgY2hyID0gdGhpcy5sYSgpO1xuXHRcdHdoaWxlKGNociAhPSBudWxsKSB7XG5cdFx0XHRpZiAodGhpcy5pc0NvbW1lbnQoKSkge1xuXHRcdFx0XHR0aGlzLmNvbW1lbnQoKTtcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5pc1N3aWdDb21tZW50KCkpIHtcblx0XHRcdFx0dGhpcy5zd2lnQ29tbWVudCgpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRjaHIgPSB0aGlzLmxhKCk7XG5cdFx0IH1cblx0XHQgcmV0dXJuIHRoaXMubGEoKTtcblx0fVxuXG5cdGlzQ29tbWVudCgpIHtcblx0XHRyZXR1cm4gdGhpcy5pc05leHQoJzwhLS0nKTtcblx0fVxuXHRjb21tZW50KCkge1xuXHRcdHRoaXMuYWR2YW5jZSg0KTtcblx0XHR3aGlsZSghdGhpcy5pc05leHQoJy0tPicpKSB7XG5cdFx0XHRpZiAodGhpcy5sYSgpID09IG51bGwpXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcignQ29tbWVudCBpcyBub3QgY2xvc2VkLCAnICsgdGhpcy5nZXRDdXJyZW50UG9zSW5mbygpKTtcblx0XHRcdHRoaXMuYWR2YW5jZSgpO1xuXHRcdH1cblx0XHR0aGlzLmFkdmFuY2UoMyk7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblx0aXNTd2lnQ29tbWVudCgpIHtcblx0XHRyZXR1cm4gdGhpcy5pc05leHQoJ3sjJyk7XG5cdH1cblx0c3dpZ0NvbW1lbnQoKSB7XG5cdFx0dGhpcy5hZHZhbmNlKDIpO1xuXHRcdHdoaWxlICghdGhpcy5pc05leHQoJyN9JykpIHtcblx0XHRcdHRoaXMuYWR2YW5jZSgpO1xuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRhZ0FzdCB7XG5cdG5hbWU/OiBzdHJpbmc7XG5cdGF0dHJzPzoge1trZXk6IHN0cmluZ106IHtpc05nOiBib29sZWFuLCB2YWx1ZTogQXR0cmlidXRlVmFsdWVBc3R9fTtcblx0c3RhcnQ6IG51bWJlcjtcblx0ZW5kOiBudW1iZXI7XG5cdFtrZXk6IHN0cmluZ106IGFueTtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgQXR0cmlidXRlVmFsdWVBc3Qge1xuXHR0ZXh0OiBzdHJpbmc7IHN0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyO1xufVxuZXhwb3J0IGNsYXNzIFRlbXBsYXRlUGFyc2VyIGV4dGVuZHMgQmFzZVBhcnNlcjxIdG1sVG9rZW5UeXBlPiB7XG5cdGxleGVyOiBUZW1wbGF0ZUxleGVyO1xuXHRjb25zdHJ1Y3RvcihpbnB1dDogc3RyaW5nKSB7XG5cdFx0Y29uc3QgbGV4ZXIgPSBuZXcgVGVtcGxhdGVMZXhlcihpbnB1dCk7XG5cdFx0c3VwZXIobGV4ZXIpO1xuXHRcdHRoaXMubGV4ZXIgPSBsZXhlcjtcblx0fVxuXG5cdGdldEN1cnJlbnRQb3NJbmZvKCk6IHN0cmluZyB7XG5cdFx0Y29uc3Qgc3RhcnQgPSB0aGlzLmxhKCkgPyB0aGlzLmxhKCkuc3RhcnQgOiBudWxsO1xuXHRcdGlmIChzdGFydCkge1xuXHRcdFx0Y29uc3QgbGluZUNvbCA9IHRoaXMubGV4ZXIuZ2V0TGluZUNvbHVtbihzdGFydCk7XG5cdFx0XHRyZXR1cm4gYExpbmUgJHtsaW5lQ29sWzBdICsgMX0gY29sdW1uICR7bGluZUNvbFsxXSArIDF9YDtcblx0XHR9XG5cdH1cblx0c2tpcCgpIHtcblx0XHR3aGlsZSAodGhpcy5sYSgpICE9IG51bGwgJiYgdGhpcy5sYSgpLnR5cGUgPT09IEh0bWxUb2tlblR5cGUuc3BhY2UpIHtcblx0XHRcdHRoaXMuYWR2YW5jZSgpO1xuXHRcdH1cblx0fVxuXHRwYXJzZSgpOiBUYWdBc3RbXSB7XG5cdFx0Y29uc3QgYXN0OiBUYWdBc3RbXSA9IFtdO1xuXHRcdHdoaWxlKHRoaXMubGEoKSAhPSBudWxsKSB7XG5cdFx0XHRpZiAodGhpcy5sYSgpLnR5cGUgPT09IEh0bWxUb2tlblR5cGVbJzwnXSkge1xuXHRcdFx0XHRhc3QucHVzaCh0aGlzLnRhZygpKTtcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5sYSgpLnR5cGUgPT09IEh0bWxUb2tlblR5cGVbJzwvJ10pIHtcblx0XHRcdFx0dGhpcy5hZHZhbmNlKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmFkdmFuY2UoKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIGFzdDtcblx0fVxuXHR0YWcoKTogVGFnQXN0IHtcblx0XHRjb25zdCBmaXJzdCA9IHRoaXMuYWR2YW5jZSgpO1xuXHRcdGNvbnN0IG5hbWUgPSBmaXJzdC50ZXh0LnN1YnN0cmluZygxKTtcblx0XHRjb25zdCBhdHRycyA9IHRoaXMuYXR0cmlidXRlcygpO1xuXHRcdGNvbnN0IGxhc3QgPSB0aGlzLmFkdmFuY2UoKTsgLy8gPlxuXHRcdHJldHVybiB7bmFtZSwgYXR0cnMsIHN0YXJ0OiBmaXJzdC5zdGFydCwgZW5kOiBsYXN0LmVuZH07XG5cdH1cblx0YXR0cmlidXRlcygpOiB7W2tleTogc3RyaW5nXToge2lzTmc6IGJvb2xlYW4sIHZhbHVlOiBBdHRyaWJ1dGVWYWx1ZUFzdH19IHtcblx0XHRjb25zdCBhdHRyczoge1trZXk6IHN0cmluZ106IHtpc05nOiBib29sZWFuLCB2YWx1ZTogQXR0cmlidXRlVmFsdWVBc3R9fSA9IHt9O1xuXHRcdHdoaWxlICh0aGlzLmxhKCkgIT0gbnVsbCAmJiB0aGlzLmxhKCkudHlwZSAhPT0gSHRtbFRva2VuVHlwZVsnPiddKSB7XG5cdFx0XHRpZiAodGhpcy5pc05nQXR0ck5hbWUoKSkge1xuXHRcdFx0XHRjb25zdCBrZXkgPSB0aGlzLm5nQXR0ck5hbWUoKTtcblx0XHRcdFx0YXR0cnNba2V5XSA9IHtpc05nOiB0cnVlLCB2YWx1ZTogdGhpcy5hdHRyVmFsdWUoKX07XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMubGEoKS50eXBlID09PSBIdG1sVG9rZW5UeXBlLmlkZW50aXR5KSB7XG5cdFx0XHRcdGNvbnN0IGtleSA9IHRoaXMuYXR0ck5hbWUoKTtcblx0XHRcdFx0YXR0cnNba2V5XSA9IHtpc05nOiBmYWxzZSwgdmFsdWU6IHRoaXMuYXR0clZhbHVlKCl9O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ1ByZXZpb3VzIHRva2VuczogJywgdGhpcy5sYigpLnRleHQpO1xuXHRcdFx0XHR0aGlzLnRocm93RXJyb3IodGhpcy5sYSgpLnRleHQpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gYXR0cnM7XG5cdH1cblx0aXNOZ0F0dHJOYW1lKCkge1xuXHRcdGNvbnN0IHR5cGUgPSB0aGlzLmxhKCkudHlwZTtcblx0XHRyZXR1cm4gdHlwZSA9PT0gSHRtbFRva2VuVHlwZVsnWyddIHx8IHR5cGUgPT09IEh0bWxUb2tlblR5cGVbJygnXTtcblx0fVxuXHRuZ0F0dHJOYW1lKCkge1xuXHRcdGNvbnN0IGtpbmQgPSB0aGlzLmxhKCkudHlwZSA9PT0gSHRtbFRva2VuVHlwZVsnWyddID8gSHRtbFRva2VuVHlwZVsnXSddIDogSHRtbFRva2VuVHlwZVsnKSddO1xuXHRcdGxldCBuYW1lOiBzdHJpbmc7XG5cdFx0dGhpcy5hZHZhbmNlKCk7XG5cdFx0aWYgKHRoaXMuaXNOZ0F0dHJOYW1lKCkpXG5cdFx0XHRuYW1lID0gdGhpcy5uZ0F0dHJOYW1lKCk7XG5cdFx0ZWxzZVxuXHRcdFx0bmFtZSA9IHRoaXMuYXR0ck5hbWUoKTtcblx0XHRpZiAodGhpcy5sYSgpLnR5cGUgIT09IGtpbmQpXG5cdFx0XHR0aGlzLnRocm93RXJyb3IodGhpcy5sYSgpLnRleHQpO1xuXHRcdHRoaXMuYWR2YW5jZSgpO1xuXHRcdHJldHVybiBuYW1lO1xuXHR9XG5cdGF0dHJOYW1lKCkge1xuXHRcdHJldHVybiB0aGlzLmFkdmFuY2UoKS50ZXh0O1xuXHR9XG5cdGF0dHJWYWx1ZSgpOiBBdHRyaWJ1dGVWYWx1ZUFzdCB7XG5cdFx0aWYgKHRoaXMubGEoKSAmJiB0aGlzLmxhKCkudHlwZSA9PT0gSHRtbFRva2VuVHlwZVsnPSddKSB7XG5cdFx0XHQvLyBsZXQge3RleHQsIHN0YXJ0LCBlbmR9ID0gdGhpcy5hZHZhbmNlKDIpO1xuXHRcdFx0Ly8gcmV0dXJuIHt0ZXh0LCBzdGFydCwgZW5kfTtcblx0XHRcdHJldHVybiB0aGlzLmFkdmFuY2UoMik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fVxufVxuIl19
